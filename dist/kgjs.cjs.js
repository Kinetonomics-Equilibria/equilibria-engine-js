"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const ue=require("mathjs"),pe=require("d3"),he=require("katex");function Et(i){const t=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(i){for(const e in i)if(e!=="default"){const n=Object.getOwnPropertyDescriptor(i,e);Object.defineProperty(t,e,n.get?n:{enumerable:!0,get:()=>i[e]})}}return t.default=i,Object.freeze(t)}const V=Et(ue),f=Et(pe),ye=Et(he),Gt=Object.freeze(Object.defineProperty({__proto__:null,get Angle(){return Xe},get AngleMarker(){return Jt},get Area(){return z},get Arrow(){return qe},get ArrowDef(){return Dt},get AuthoringObject(){return U},get Axis(){return ze},get BowlesHallidaySchema(){return We},get CESFunction(){return oe},get Circle(){return Ve},get ClipPath(){return ot},get CobbDouglasFunction(){return ie},get ConcaveFunction(){return ne},get Contour(){return Yt},get ContourMap(){return Te},get CrossGraphHorizontalDropline(){return Fe},get CrossGraphSegment(){return Ce},get CrossGraphVerticalDropline(){return Ee},get Curve(){return H},get DefObject(){return Ft},get Dropline(){return At},get EconBudgetLine(){return D},get EconBundle(){return pt},get EconCompetitiveDemand(){return He},get EconConstantElasticityCurve(){return dt},get EconConstantElasticityEquilibrium(){return un},get EconConstantElasticityIntersection(){return cn},get EconContractCurve(){return sn},get EconDemandCurve(){return pn},get EconDemandPoint(){return hn},get EconHicksBundle(){return nn},get EconIndifferenceCurve(){return kt},get EconIndifferenceMap(){return Je},get EconLagrangeBundle(){return Ke},get EconLinearDemand(){return xt},get EconLinearEquilibrium(){return ln},get EconLinearMC(){return Kt},get EconLinearMonopoly(){return Ue},get EconLinearSupply(){return $t},get EconMultivariateFunction(){return et},get EconNetDemandCurve(){return yn},get EconNetDemandPoint(){return mn},get EconNetSupplyCurve(){return xn},get EconNetSupplyPoint(){return gn},get EconOneInputProductionFunction(){return St},get EconOptimalBundle(){return at},get EconPPF(){return an},get EconParetoLens(){return Ye},get EconPriceOfferCurve(){return bn},get EconSchema(){return Lt},get EconShortRunProductionBundle(){return rn},get EconSlutskyBundle(){return en},get Edge(){return ft},get EdgeworthBox(){return vn},get EdgeworthBoxAboveOneGraphPlusSidebar(){return dn},get EdgeworthBoxPlusSidebar(){return On},get EdgeworthBoxPlusTwoGraphsPlusSidebar(){return Sn},get EdgeworthBoxSquare(){return Pn},get Ellipse(){return Zt},get EndArrow(){return En},get EntryDeterrence(){return wn},get ExchangeEquilibriumBundle(){return on},get FourGraphs(){return _e},get GameMatrixPlusGraph(){return ke},get Graph(){return S},get GraphObject(){return _},get GraphObjectGenerator(){return M},get Grid(){return Wt},get HorizontalDropline(){return Qt},get Layout(){return N},get Line(){return ut},get LineCircleIntersection(){return Ne},get LinearFunction(){return te},get LowdownSchema(){return Qe},get LowestCostBundle(){return tn},get Marker(){return se},get MinFunction(){return re},get Node(){return mt},get OneGraph(){return Ge},get OneTree(){return Re},get OneWideGraph(){return Be},get Overlap(){return Ae},get Point(){return E},get Points(){return fe},get PositionedObject(){return Ht},get QuasilinearFunction(){return ee},get Rectangle(){return J},get Scale(){return wt},get Schema(){return qt},get Segment(){return B},get SquareLayout(){return Y},get SquarePlusTwoVerticalGraphs(){return De},get StartArrow(){return Cn},get ThreeHorizontalGraphs(){return Me},get Tree(){return jt},get TwoHorizontalGraphs(){return $e},get TwoVerticalGraphs(){return je},get TwoVerticalGraphsRoom200(){return Le},get TwoVerticalSquaresOneBigSquare(){return Ie},get VerticalDropline(){return Xt},get WideRectangleLayout(){return Ut}},Symbol.toStringTag,{value:"Module"})),me=Object.freeze(Object.defineProperty({__proto__:null,get Area(){return Rn},get Axis(){return Gn},get Circle(){return In},get Contour(){return Mn},get ContourMap(){return Dn},get Curve(){return kn},get Ellipse(){return ae},get GeoGebraObject(){return Ln},get Label(){return jn},get Marker(){return Tt},get Point(){return An},get Rectangle(){return fn},get Segment(){return Fn},get ViewObject(){return I},get ViewObjectClasses(){return yt}},Symbol.toStringTag,{value:"Module"}));function u(i,t){i||(i={});for(let e in t)i.hasOwnProperty(e)||(i[e]=t[e]);return i}function C(i,t,e){return i[t]||(i[t]=[]),e.forEach(function(n){i[t].push(n)}),i}class xe{constructor(t){function e(n){let r=(""+n).match(/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/);return r?Math.max(0,(r[1]?r[1].length:0)-(r[2]?+r[2]:0)):0}u(t,{min:0,max:10,round:1,label:""}),this.name=t.name,this.label=t.label,typeof t.value=="boolean"?(this.value=+t.value,this.min=0,this.max=100,this.round=1):(this.value=parseFloat(t.value),this.min=parseFloat(t.min),this.max=parseFloat(t.max),this.round=parseFloat(t.round),this.precision=parseInt(t.precision)||e(this.round.toString()))}update(t){let e=this;return t<e.min?e.value=e.min:t>e.max?e.value=e.max:e.value=Math.round(t/e.round)*e.round,e.value}formatted(t){return t=t||this.precision,f.format(`.${t}f`)(this.value)}}class ge{constructor(t){this.expression=t.expression,this.type=t.type,this.min=t.min,this.max=t.max}valid(t){const e=this;return t.evaluate(e.expression),t.evaluate(e.min),t.evaluate(e.max),!0}}class be{constructor(t){let e=this;e.params=t.params.map(function(n){return new xe(n)}),e.initialParams=t.params,e.calcs=t.calcs,e.colors=t.colors,e.idioms=t.idioms,e.clearColor=t.clearColor,e.restrictions=(t.restrictions||[]).map(function(n){return new ge(n)}),e.updateListeners=[],e.currentParamValues=e.evalParams(),e.evalCalcs(),e.currentColors=e.evalObject(e.colors),e.currentIdioms=e.evalObject(e.idioms)}addUpdateListener(t){return this.updateListeners.push(t),this}resetParams(){const t=this;t.initialParams.forEach(function(e){t.updateParam(e.name,e.value)}),t.update(!0)}evalParams(){let t={};return this.params.forEach(function(e){t[e.name]=e.value}),t}evalCalcs(){const t=this;t.currentCalcValues={},t.currentCalcValues=t.evalObject(t.calcs,!0);for(let e=0;e<5;e++)for(const n in t.currentCalcValues)typeof t.calcs[n]=="object"?t.currentCalcValues[n]=t.evalObject(t.calcs[n],!0):isNaN(t.currentCalcValues[n])&&typeof t.calcs[n]=="string"&&(t.currentCalcValues[n]=t.evaluate(t.calcs[n],!0));return t.currentCalcValues}evalObject(t,e){const n=this;let r={};for(const o in t){const s=t[o];typeof s=="number"?r[o]=s:typeof s=="string"?r[o]=n.evaluate(s,e):r[o]=n.evalObject(s,e)}return r}evaluate(t,e){const n=this;if(!isNaN(parseFloat(t)))return parseFloat(t);const r=n.currentParamValues,o=n.currentCalcValues,s=n.currentColors,a=n.currentIdioms,l={...r,...o,...s,...a,params:r,calcs:o,idioms:a,colors:s,d3:{schemeCategory10:["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"]}};try{return V.compile(t).evaluate(l)}catch{return t}}latexColors(){let t=`%% econ colors %%
`,e=this;for(const n in e.colors)t+=`\\definecolor{${n}}{HTML}{${e.evaluate(e.colors[n]).replace("#","")}}
`;return t}getParam(t){const e=this.params;for(let n=0;n<e.length;n++)if(e[n].name==t)return e[n]}updateParam(t,e){let n=this,r=n.getParam(t);const o=r.value;if(r.update(e),o!=r.value){let s=!0;n.restrictions.forEach(function(a){a.valid(n)||(s=!1)}),s?n.update(!1):r.update(o),n.update(!1)}}toggleParam(t){const e=this.getParam(t).value;this.updateParam(t,!e)}cycleParam(t){const e=this.getParam(t);this.updateParam(t,e.value<e.max?e.value++:0)}update(t){const e=this;e.currentParamValues=e.evalParams(),e.evalCalcs(),e.currentColors=e.evalObject(e.colors),e.updateListeners.forEach(function(n){n.update(t)})}}function L(i){let t="KGID_";const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let n=0;n<i;n++)t+=e.charAt(Math.floor(Math.random()*e.length));return t}class ht{constructor(t){t.constants=(t.constants||[]).concat(["model","updatables","name"]);let e=this;e.def=t,t.constants.forEach(function(n){e[n]=isNaN(parseFloat(t[n]))?t[n]:+t[n]}),e.id=L(10),e.model.addUpdateListener(this)}updateArray(t){let e=this;return t.map(function(n){if(Array.isArray(n))return e.updateArray(n);{const r=n;let o=e.model.evaluate(n);return r!=o&&(e.hasChanged=!0),o}})}updateDef(t){let e=this;if(e.def.hasOwnProperty(t)){const n=e.def[t],r=e[t];if(Array.isArray(n))e[t]=e.updateArray(n);else{let o=e.model.evaluate(n);r!=o&&(e.hasChanged=!0,e[t]=o)}}return e}update(t){let e=this;return e.hasChanged=!!t,e.hasOwnProperty("updatables")&&e.updatables!=null&&e.updatables.forEach(function(n){e.updateDef(n)}),e}}let we=class extends ht{constructor(t){u(t,{log:!1}),t.constants=["rangeMin","rangeMax","axis","name"],t.updatables=["domainMin","domainMax","intercept"],super(t),this.scale=t.log?f.scaleLog():f.scaleLinear(),this.update(!0)}update(t){let e=super.update(t);if(e.extent!=null){const n=e.rangeMin*e.extent,r=e.rangeMax*e.extent;e.scale.domain([e.domainMin,e.domainMax]),e.scale.range([n,r])}return e}updateDimensions(t,e){let n=this;return n.extent=n.axis=="x"?t:e,n.update(!0)}};class ve extends ht{constructor(t){t.dragListeners=t.dragListeners||[],t.clickListeners=t.clickListeners||[],t.constants=(t.constants||[]).concat(["viewObject","dragListeners","clickListeners"]),super(t),this.dragListeners=t.dragListeners,this.clickListeners=t.clickListeners,this.viewObject=t.viewObject,this.update(!0),this.scope={params:{},calcs:{},colors:{},drag:{}}}update(t){let e=super.update(t);if(e.hasChanged&&e.hasOwnProperty("dragListeners")&&e.element!=null){let n=!1,r=!1;e.dragListeners.forEach(function(o){o.update(t),o.directions=="x"?n=!0:o.directions=="y"?r=!0:o.directions=="xy"&&(n=!0,r=!0)}),e.element.style("pointer-events",n||r?"all":"none"),e.element.style("cursor",n&&r?"move":n?"ew-resize":"ns-resize")}return e.hasOwnProperty("clickListeners")&&e.element!=null&&e.clickListeners.length>0&&(e.element.style("pointer-events","all"),e.element.style("cursor","pointer")),e}addTrigger(t){let e=this;e.element=t,e.clickListeners.length>0&&t.on("click",function(n,r){e.clickListeners.forEach(function(o){o.click()})}),e.dragListeners.length>0&&t.call(f.drag().on("start",function(n,r){e.scope.params=e.model.currentParamValues,e.scope.calcs=e.model.currentCalcValues,e.scope.colors=e.model.currentColors,e.scope.drag.x0=e.viewObject.xScale.scale.invert(n.x),e.scope.drag.y0=e.viewObject.yScale.scale.invert(n.y)}).on("drag",function(n,r){let o=e.scope.drag;o.x=e.viewObject.xScale.scale.invert(n.x),o.y=e.viewObject.yScale.scale.invert(n.y),o.dx=o.x-o.x0,o.dy=o.y-o.y0,e.dragListeners.forEach(function(s){s.onChange(e.scope)})}).on("end",function(n,r){})),e.update(!0)}}class Nt extends ht{constructor(t){C(t,"updatables",["expression"]),C(t,"constants",["param"]),super(t)}onChange(t){const e=this;let r=V.compile(e.expression).evaluate(t);e.model.updateParam(e.param,r)}}class Pe extends Nt{constructor(t){u(t,{transitions:[1,0]}),super(t),this.transitions=t.transitions}click(){const t=this,e=t.model.currentParamValues[t.param],n=t.transitions[e];t.model.updateParam(t.param,n)}}class Oe extends Nt{constructor(t){t.hasOwnProperty("vertical")&&(t.directions="y",t.param=t.vertical,t.expression=`params.${t.vertical} + drag.dy`),t.hasOwnProperty("horizontal")&&(t.directions="x",t.param=t.horizontal,t.expression=`params.${t.horizontal} + drag.dx`),u(t,{directions:"xy"}),C(t,"updatables",["draggable","directions"]),super(t)}update(t){let e=super.update(t);return e.def.hasOwnProperty("draggable")||(e.draggable=e.directions.length>0),e}}class I extends ht{constructor(t){u(t,{alwaysUpdate:!1,interactive:!0,fill:"colors.blue",fillOpacity:.2,stroke:"colors.blue",strokeWidth:1,stokeOpacity:1,show:!0,inDef:!1,lineStyle:"solid",checkOnGraph:!0}),C(t,"updatables",["xScaleMin","xScaleMax","yScaleMin","yScaleMax","fill","stroke","strokeWidth","opacity","strokeOpacity","show","lineStyle","srTitle","srDesc"]),C(t,"constants",["xScale","yScale","clipPath","clipPath2","interactive","alwaysUpdate","inDef","checkOnGraph","tabbable"]),C(t,"colorAttributes",["stroke","fill","color"]),t.inDef&&(t.show=!0),super(t);let e=this;if(e.hasOwnProperty("xScale")&&e.xScale&&(t.xScaleMin=e.xScale.def.domainMin,t.xScaleMax=e.xScale.def.domainMax,t.yScaleMin=e.yScale.def.domainMin,t.yScaleMax=e.yScale.def.domainMax),t.colorAttributes.forEach(function(n){let r=t[n];e.model.colors.hasOwnProperty(r)&&(t[n]=e.model.colors[r])}),t.interactive){t.drag=t.drag||[];const n=t.drag.map(function(o){return o.model=e.model,new Oe(o)});t.click=t.click||[];const r=t.click.map(function(o){return o.model=e.model,new Pe(o)});e.interactionHandler=new ve({viewObject:e,model:e.model,dragListeners:n,clickListeners:r})}t.hasOwnProperty("layer")&&e.draw(t.layer).update(!0).init()}init(){return this}addScreenReaderDescriptions(t){const e=this;return e.rootElement,e.def.hasOwnProperty("srTitle")&&e.def.srTitle!=null&&(e.screenReaderTitle=t.selectAll("title.screenReaderTitle-"+e.id).data([1]).join("title").attr("class","screenReaderTitle-"+e.id)),e.def.hasOwnProperty("srDesc")&&e.def.srDesc!=null&&(e.screenReaderDescription=t.selectAll("desc.screenReaderDescription-"+e.id).data([1]).join("desc").attr("class","screenReaderDescription-"+e.id)),e}updateScreenReaderDescriptions(){const t=this;return t.hasOwnProperty("srTitle")&&t.srTitle!=null&&t.screenReaderTitle.text(t.srTitle),t.hasOwnProperty("srDesc")&&t.srDesc!=null&&t.screenReaderDescription.text(t.srDesc),t}addClipPathAndArrows(){const t=this;return t.hasOwnProperty("clipPath")&&t.clipPath!=null&&t.rootElement.attr("clip-path",`url(#${t.clipPath})`),t.hasOwnProperty("clipPath2")&&t.clipPath2!=null&&t.rootElement2.attr("clip-path",`url(#${t.clipPath2})`),t.hasOwnProperty("endArrow")&&t.endArrow!=null&&t.markedElement.attr("marker-end",`url(#${t.endArrow})`),t.hasOwnProperty("startArrow")&&t.endArrow!=null&&t.markedElement.attr("marker-start",`url(#${t.startArrow})`),t}addInteraction(){const t=this;return t.interactionHandler.addTrigger(t.rootElement),t}draw(t,e){return this}redraw(){return this}drawStroke(t){const e=this;t.attr("stroke",e.stroke),t.attr("stroke-width",e.strokeWidth),t.style("stroke-opacity",e.strokeOpacity),e.lineStyle=="dashed"?t.style("stroke-dashArray","10,10"):e.lineStyle=="dotted"?t.style("stroke-dashArray","1,2"):t.style("stroke-dashArray","10,0")}drawFill(t){const e=this;t.style("fill",e.fill),t.style("fill-opacity",e.opacity)}displayElement(t){let e=this;e.hasOwnProperty("rootElement")&&e.rootElement.style("display",t?null:"none")}onGraph(){const t=this;if(t.checkOnGraph){let e=function(n,r,o){const s=Math.min(r,o),a=Math.max(r,o);return n<s||n>a};if(t.hasOwnProperty("x")&&e(t.x,t.xScale.domainMin,t.xScale.domainMax)||t.hasOwnProperty("y")&&e(t.y,t.yScale.domainMin,t.yScale.domainMax))return!1}return!0}update(t){let e=super.update(t);return e.show&&e.onGraph()||e.inDef?(e.displayElement(!0),e.hasChanged&&e.redraw()):e.displayElement(!1),e}}let Tt=class extends I{constructor(t){C(t,"constants",["maskPath","arrowPath"]),C(t,"updatables",["color"]),super(t)}draw(t){let e=this;return t.append("svg:path").attr("d",e.maskPath).attr("fill","white"),e.arrowElement=t.selectAll("path.arrowElement-"+e.id).data([1]).join("svg:path").attr("class","arrowElement-"+e.id).attr("d",e.arrowPath),e}redraw(){let t=this;return t.arrowElement.attr("fill",t.color),t}};class U{constructor(t){this.def=t,this.name=t.name,this.subObjects=[],t.hasOwnProperty("srTitle")&&(this.srTitle=t.srTitle,this.tabbable=!0),t.hasOwnProperty("srDesc")&&(this.srDesc=t.srDesc,this.tabbable=!0)}parseSelf(t){return t}parse(t){return this.subObjects.forEach(function(e){t=e.parse(t)}),delete this.subObjects,t=this.parseSelf(t),t}addSecondGraph(t){let e=this.def;e.hasOwnProperty("yScale2Name")&&(e.xScale2Name=t.xScale.name,e.yScale2Name=t.yScale.name),this.subObjects.forEach(function(n){n.addSecondGraph(t)})}}class M extends U{constructor(t,e){super(t),e&&(this.def.xScaleName=e.xScale.name,this.def.yScaleName=e.yScale.name,t.inDef||(this.def.clipPathName=t.clipPathName||e.clipPath.name)),this.subObjects=[]}extractCoordinates(t,e,n){t=t||"coordinates",e=e||"x",n=n||"y";let r=this,o=this.def;o.hasOwnProperty(t)&&o[t]!=null&&(o[e]=o[t][0].toString(),o[n]=o[t][1].toString(),delete o[t]),r[e]=o[e].toString(),r[n]=o[n].toString()}}class Ft extends M{constructor(t,e){t.inDef=!0,super(t,e)}parseSelf(t){return delete this.def.clipPathName,t.clipPaths.push(this.def),t}}class ot extends Ft{parseSelf(t){return delete this.def.clipPathName,t.clipPaths.push(this.def),t}}const Q={};class _ extends M{constructor(t,e){t.hasOwnProperty("clipPaths")&&(t.clipPathName=L(10)),u(t,{name:L(10)}),super(t,e);let n=this;if(t.hasOwnProperty("color")&&(n.color=t.color),t.hasOwnProperty("clipPaths")){let r=t.clipPaths.map(function(o){const s=Object.keys(o)[0];let a=o[s];return a.inDef=!0,new Q[s](a,e)});n.subObjects.push(new ot({name:t.clipPathName,paths:r},e))}}parseSelf(t){return t.layers[this.layer].push(this),t}}let k=class extends _{constructor(t,e){t.hasOwnProperty("position")&&(t.position.toLowerCase()=="bl"&&(t.xPixelOffset=5,t.yPixelOffset=10,t.align="left"),t.position.toLowerCase()=="tr"&&(t.xPixelOffset=-5,t.yPixelOffset=-12,t.align="right")),super(t,e),this.type="Label",this.extractCoordinates()}parseSelf(t){return t.divs.push({type:this.type,def:this.def}),t}},z=class extends _{constructor(t,e){u(t,{color:"colors.blue",opacity:.2}),t=st(t),Z(t,"fn","univariateFunction1"),Z(t,"fn1","univariateFunction1"),Z(t,"fn2","univariateFunction2"),super(t,e),this.type="Area",this.layer=t.layer||0}},H=class extends _{constructor(t,e){t=q(t),Z(t,"fn","univariateFunction"),Z(t,"xFn","parametricFunction"),super(t,e);const n=this;if(n.type="Curve",n.layer=t.layer||1,n.pts=t.pts||[],t.hasOwnProperty("areaBelow")&&(u(t.areaBelow,{color:t.color}),Bt(t,"areaBelow"),u(t.areaBelow,t.univariateFunction),Z(t.areaBelow,"fn","univariateFunction1"),n.subObjects.push(new z(t.areaBelow,e))),t.hasOwnProperty("areaAbove")&&(u(t.areaBelow,{color:t.color}),Bt(t,"areaAbove"),u(t.areaAbove,t.univariateFunction),Z(t.areaAbove,"fn","univariateFunction1"),t.areaAbove.above=!0,n.subObjects.push(new z(t.areaAbove,e))),t.hasOwnProperty("label")){let r=d(t);delete r.label,r=u(r,t.label),r=u(r,{fontSize:12,color:t.color}),t.hasOwnProperty("univariateFunction")&&(r.hasOwnProperty("x")&&t.univariateFunction.ind!="y"?(r.coordinates=[r.x,n.yOfX(r.x)],n.subObjects.push(new k(r,e))):r.hasOwnProperty("y")&&t.univariateFunction.ind!="x"&&(r.coordinates=[n.xOfY(r.y),r.y],n.subObjects.push(new k(r,e)))),t.hasOwnProperty("parametricFunction")&&r.hasOwnProperty("t")&&(r.coordinates=n.xyOfT(r.t),n.subObjects.push(new k(r,e)))}}yOfX(t){return`(${it(this.def.univariateFunction.fn,"(x)",`(${t})`)})`}xOfY(t){const e=this;return e.def.univariateFunction.hasOwnProperty("yFn")?`(${it(e.def.univariateFunction.yFn,"(y)",`(${t})`)})`:`(${it(e.def.univariateFunction.fn,"(y)",`(${t})`)})`}xyOfT(t){return[it(this.def.parametricFunction.xFunction,"(t)",`(${t})`),it(this.def.parametricFunction.yFunction,"(t)",`(${t})`)]}parseSelf(t){let e=this;return t=super.parseSelf(t),t.calcs[e.name]=t.calcs[e.name]||{},e.pts.forEach(function(n){n.hasOwnProperty("x")&&(t.calcs[e.name][n.name]={x:n.x,y:e.yOfX(n.x)}),n.hasOwnProperty("y")&&(t.calcs[e.name][n.name]={x:e.xOfY(n.y),y:n.y})}),t}};function Vt(i){return i.hasOwnProperty("type")||(i.type=Object.keys(i)[0],i.def=i[i.type]),i}function Se(i,t){return i.forEach(function(e){Object.prototype.hasOwnProperty.call(Q,e.type)&&(t=new Q[e.type](e.def).parse(t))}),t}function ct(i){return typeof i=="string"&&i.match(/[\*/+-]/)?"("+i+")":i}function R(i){return p(-1,i)}function K(i,t,e){if(typeof i=="number"&&typeof t=="number")switch(e){case"+":return i+t;case"-":return i-t;case"/":return i/t;case"*":return i*t;case"^":return Math.pow(i,t)}else return"("+ct(i)+e+ct(t)+")"}function O(i,t){return i==0?t:t==0?i:K(i,t,"+")}function x(i,t){return t==0?i:K(i,t,"-")}function y(i,t){return i==0?0:t==1?i:K(i,t,"/")}function j(i){return K(1,i,"/")}function p(i,t){return i==0||t==0?0:i==1?t:t==1?i:K(i,t,"*")}function G(i,t,e){return e=e||.5,O(p(e,i),p(x(1,e),t))}function rt(i){return K(i,i,"*")}function Rt(i){return w(i,.5)}function w(i,t){return K(i,t,"^")}function de(i,t,e,n){const r=R(t),o=x(rt(t),p(4,p(i,e))),s=n?O(r,Rt(o)):x(r,Rt(o)),a=p(2,i);return y(s,a)}function A(i){return typeof i=="string"?i.replace("params.",""):i}function zt(i){return i.hasOwnProperty("draggable")&&!i.hasOwnProperty("drag")&&(i.draggable==!0||i.draggable=="true")&&(i.drag=[],i.x==`params.${A(i.x)}`&&i.drag.push({horizontal:A(i.x)}),i.y==`params.${A(i.y)}`&&i.drag.push({vertical:A(i.y)})),i}function nt(i,t,e){return i.map(function(n){let r=d(t);return r.hasOwnProperty("min")&&(n.min=r.min),r.hasOwnProperty("max")&&(n.max=r.max),n.hasOwnProperty("show")&&(r.show=n.show),n.hasOwnProperty("parametric")?r.parametricFunction=n:r.univariateFunction=n,new H(r,e)})}function st(i){return i.open?(i.fill="white",i.color=i.color||i.stroke,i.stroke=i.stroke||i.color,i):(i.color=i.color||i.fill,i.fill=i.fill||i.color,i)}function q(i){return i.color=i.color||i.stroke,i.stroke=i.stroke||i.color,i}function d(i){return JSON.parse(JSON.stringify(i))}function it(i,t,e){typeof i!="string"&&(i=String(i));let n=i.split(t).join(e),r=t.replace(/[\(\)]/g,"");if(r){let o=new RegExp(`\\b${r}\\b`,"g");n=n.replace(o,e)}return`(${n})`}function Z(i,t,e){if(!i.hasOwnProperty(e)&&i.hasOwnProperty(t))if(e=="parametricFunction")i.parametricFunction={xFunction:i.xFn,yFunction:i.yFn,min:i.min,max:i.max,samplePoints:i.samplePoints};else{const n={fn:i[t],ind:i[t].indexOf("(y)")>-1?"y":"x"};i.min!=null&&(n.min=i.min),i.max!=null&&(n.max=i.max),i.samplePoints!=null&&(n.samplePoints=i.samplePoints),i[e]=n}}function Bt(i,t){const e=i[t];if(typeof e=="string"&&(i[t]={fill:e}),typeof e=="boolean"&&e){const n=i.hasOwnProperty("fill")?i.fill:i.color;i[t]={fill:n}}}class qt extends U{constructor(t){const e={blue:"d3.schemeCategory10[1]",orange:"d3.schemeCategory10[2]",green:"d3.schemeCategory10[3]",red:"d3.schemeCategory10[4]",purple:"d3.schemeCategory10[5]",brown:"d3.schemeCategory10[6]",magenta:"d3.schemeCategory10[7]",grey:"d3.schemeCategory10[8]",gray:"d3.schemeCategory10[8]",olive:"d3.schemeCategory10[9]"};for(const n in t.colors){const r=t.colors[n];e.hasOwnProperty(r)&&(t.colors[n]=e[r])}t.colors=u(t.colors||{},e),super(t),this.colors=t.colors,this.idioms=t.idioms}parseSelf(t){const e=this.colors;return t.colors=u(t.colors||{},e),t.idioms=this.idioms,t}}let B=class extends _{constructor(t,e){t=q(t),t.hasOwnProperty("startArrow")&&(t.startArrowName=e.getStartArrowName(t.color)),t.hasOwnProperty("endArrow")&&(t.endArrowName=e.getEndArrowName(t.color)),super(t,e);const n=this;if(n.type="Segment",n.layer=1,n.extractCoordinates("a","x1","y1"),n.extractCoordinates("b","x2","y2"),t.hasOwnProperty("trim")){const r=n.x1,o=n.y1,s=n.x2,a=n.y2;n.def.x1=G(s,r,t.trim),n.def.x2=G(r,s,t.trim),n.def.y1=G(a,o,t.trim),n.def.y2=G(o,a,t.trim)}if(t.hasOwnProperty("label")){let r=d(t);delete r.label,typeof t.label=="string"&&(t.label={text:t.label}),r=u(t.label||{},r),r=u(r,{fontSize:12,color:t.color,location:.5}),r.coordinates=[G(n.x1,n.x2,r.location),G(n.y1,n.y2,r.location)],n.subObjects.push(new k(r,e))}if(t.hasOwnProperty("handles")){let r={x:n.x1,y:n.y1,color:t.color,r:4,draggable:t.draggable,show:t.show},o={x:n.x2,y:n.y2,color:t.color,r:4,draggable:t.draggable,show:t.show};n.subObjects.push(new Q.Point(r,e)),n.subObjects.push(new Q.Point(o,e))}}};class Ce extends B{constructor(t,e){t.xScale2Name="",super(t,e)}}class ft extends B{constructor(t,e){t.a=e.nodeCoordinates[t.node1],t.b=e.nodeCoordinates[t.node2],super(t,e)}}class At extends B{constructor(t,e){t.lineStyle="dotted",delete t.label,super(t,e)}}class Xt extends At{constructor(t,e){t.a=[t.x,e.xScale.intercept],t.b=[t.x,t.y],super(t,e)}}class Ee extends Xt{constructor(t,e){t.xScale2Name="",super(t,e)}}class Qt extends At{constructor(t,e){t.a=[e.yScale.intercept,t.y],t.b=[t.x,t.y],super(t,e)}}class Fe extends Qt{constructor(t,e){t.xScale2Name="",super(t,e)}}class Wt extends M{constructor(t,e){t=t||{},super(t,e),u(t,{strokeWidth:1,stroke:"lightgrey",lineStyle:"dotted",layer:0,xStep:1,yStep:1,xGridlines:10,yGridlines:10});const n=this;n.subObjects=[];for(let r=0;r<t.xGridlines;r++){const o=p(r,t.xStep);let s=d(t);d(t),s.a=[o,e.yScale.min],s.b=[o,e.yScale.max],n.subObjects.push(new B(s,e))}for(let r=0;r<t.yGridlines;r++){const o=p(r,t.yStep);d(t);let s=d(t);s.a=[e.xScale.min,o],s.b=[e.xScale.max,o],n.subObjects.push(new B(s,e))}}}let E=class extends _{constructor(t,e){u(t,{color:"colors.blue"}),t=st(t),super(t,e);const n=this;if(n.type="Point",n.layer=3,n.extractCoordinates(),t=zt(t),t.hasOwnProperty("label")){let r=d(t);delete r.label,r=u(r,t.label),r=u(r,{fontSize:10,position:"bl",color:t.color,bgcolor:null}),n.subObjects.push(new k(r,e))}if(t.hasOwnProperty("droplines")){if(t.droplines.hasOwnProperty("vertical")){let r=d(t);if(r.hasOwnProperty("drag")&&(r.drag=r.drag.filter(function(s,a,l){return s.directions=="x"||s.hasOwnProperty("horizontal")})),t.droplines.hasOwnProperty("top")){r.y=e.yScale.max;let s=d(r);s.y="OPPAXIS",u(s,{text:t.droplines.top,fontSize:10}),n.subObjects.push(new k(s,e))}r.lineStyle="dotted",delete r.label,r.a=[r.x,e.xScale.intercept],r.b=[r.x,r.y],n.subObjects.push(new B(r,e));let o=d(r);o.y="AXIS",u(o,{text:t.droplines.vertical,fontSize:10}),n.subObjects.push(new k(o,e))}if(t.droplines.hasOwnProperty("horizontal")){let r=d(t);r.hasOwnProperty("drag")&&(r.drag=r.drag.filter(function(s,a,l){return s.directions=="y"||s.hasOwnProperty("vertical")})),r.lineStyle="dotted",delete r.label,r.a=[e.yScale.intercept,r.y],r.b=[r.x,r.y],n.subObjects.push(new B(r,e));let o=d(r);o.x="AXIS",u(o,{text:t.droplines.horizontal,fontSize:10}),n.subObjects.push(new k(o,e))}}}parseSelf(t){let e=this;return t=super.parseSelf(t),t.calcs[e.name]={x:e.x.toString(),y:e.y.toString()},t}};class fe extends M{constructor(t,e){super(t,e);const n=this;t.coordinates.forEach(function(o){const s=JSON.parse(JSON.stringify(t));s.coordinates=o,n.subObjects.push(new E(s,e))})}}class mt extends E{constructor(t,e){if(u(t,{name:L(10)}),t.hasOwnProperty("payoffs")){const r="\\\\color{${colors.player1}}{"+t.payoffs.player1+"}",o="\\\\color{black}{,\\\\ }",s="\\\\color{${colors.player2}}{"+t.payoffs.player2+"}";t.label={text:"`"+r+o+s+"`",position:t.payoffs.position||"l",fontSize:14}}super(t,e);const n=this;if(e.nodeCoordinates[t.name]=[n.x,n.y],n.name=t.name,t.hasOwnProperty("children")){const r=t.children.length;for(let o=0;o<r;o++){const s=o+1;let a=t.children[o];u(a,{name:L(10)});let l={node1:t.name,node2:a.name,color:t.color,label:{text:a.edgeLabel,x:0,y:0}};if(t.hasOwnProperty("childSelectParam")){let c=t.childSelectParam,h=new Array(r+1);h[0]=s;for(let m=1;m<r+1;m++)h[m]=m==s?0:s;l.click=[{param:c,transitions:h}],l.strokeWidth=`((params.${t.childSelectParam} == ${s}) ? 6 : 2)`}e.subObjects.push(new mt(a,e)),e.subObjects.push(new ft(l,e))}}}}let J=class extends _{constructor(t,e){st(t),super(t,e);let n=this;if(n.type="Rectangle",n.layer=t.layer||0,n.extractCoordinates("a","x1","y1"),n.extractCoordinates("b","x2","y2"),t.hasOwnProperty("label")){let r=d(t);delete r.label,r=u(r,t.label),r=u(r,{fontSize:10,color:t.color,bgcolor:null,x:G(n.x1,n.x2),y:G(n.y1,n.y2)}),n.subObjects.push(new k(r,e))}}};class Ae extends J{constructor(t,e){const n=L(10),r=L(10);t=st(t),u(t,{x1:e.def.xAxis.min,x2:e.def.xAxis.max,y1:e.def.yAxis.min,y2:e.def.yAxis.max,clipPathName:n,clipPathName2:r}),super(t,e);let o=this,s=t.shapes.map(function(a){const l=Object.keys(a)[0];let c=a[l];return c.inDef=!0,new Q[l](c,e)});o.subObjects.push(new ot({name:n,paths:[s[0]]},e)),o.subObjects.push(new ot({name:r,paths:[s[1]]},e))}}class wt extends U{constructor(t){u(t,{intercept:0}),super(t),this.min=t.domainMin,this.max=t.domainMax,this.intercept=t.intercept}parseSelf(t){return t.scales.push(this.def),t}}class Ht extends U{constructor(t){u(t,{xAxis:{},yAxis:{}}),u(t.xAxis,{min:0,max:10,intercept:0,title:"",orient:"bottom"}),u(t.yAxis,{min:0,max:10,intercept:0,title:"",orient:"left"}),super(t);const e=this,n=t.xAxis.min,r=t.xAxis.max,o=t.xAxis.intercept,s=t.xAxis.log,a=t.yAxis.min,l=t.yAxis.max,c=t.yAxis.intercept,h=t.yAxis.log,m=t.position.x,g=O(t.position.x,t.position.width),v=O(t.position.y,t.position.height),P=t.position.y;e.xScale=new wt({name:L(10),axis:"x",domainMin:n,domainMax:r,rangeMin:m,rangeMax:g,log:s,intercept:o}),e.yScale=new wt({name:L(10),axis:"y",domainMin:a,domainMax:l,rangeMin:v,rangeMax:P,log:h,intercept:c}),e.subObjects=[e.xScale,e.yScale],e.def.hasOwnProperty("objects")&&e.def.objects.map(Vt)}}class S extends Ht{constructor(t){t=u(t,{objects:[]}),super(t);const e=this;t.xAxis.otherMin=t.yAxis.min,t.xAxis.otherMax=t.yAxis.max,t.yAxis.otherMin=t.xAxis.min,t.yAxis.otherMax=t.xAxis.max,e.clipPath=new ot({name:L(10),paths:[new J({x1:t.xAxis.min,x2:t.xAxis.max,y1:t.yAxis.min,y2:t.yAxis.max,inDef:!0},e)]},e),e.subObjects.push(e.clipPath),e.def.objects.unshift({type:"Axis",def:e.def.xAxis}),e.def.objects.unshift({type:"Axis",def:e.def.yAxis}),e.def.objects.forEach(function(n){e.subObjects.push(new Q[n.type](n.def,e))})}getMarkerName(t){const e=this;let n="",r=!1;if(e.subObjects.forEach(function(o){o.hasOwnProperty("color")&&o.color==t.color&&o.hasOwnProperty("markerType")&&o.markerType==t.markerType&&(n=o.name,r=!0)}),r)return n;{const o=new Q[t.markerType]({color:t.color});return e.subObjects.push(o),o.name}}getEndArrowName(t){return this.getMarkerName({markerType:"EndArrow",color:t})}getStartArrowName(t){return this.getMarkerName({markerType:"StartArrow",color:t})}}class jt extends S{constructor(t){let e=t.showGrid||!1,n={position:t.position,objects:t.objects,xAxis:{max:24,ticks:24,show:e},yAxis:{max:24,ticks:24,show:e}};super(n);const r=this;r.nodeCoordinates={},r.subObjects.push(new Wt({xStep:3,yStep:3,show:e},r)),t.nodes.forEach(function(o){r.subObjects.push(new mt(o,r))}),t.hasOwnProperty("edges")&&t.edges.forEach(function(o){r.subObjects.push(new ft(o,r))})}}class N extends U{constructor(t){super(t),this.aspectRatio=2,this.nosvg=!1}parseSelf(t){return t.aspectRatio=this.aspectRatio,t.nosvg=this.nosvg,t}}class Y extends N{constructor(t){super(t),this.aspectRatio=1.22}}class Ut extends N{constructor(t){super(t),this.aspectRatio=2.44}}class je extends Y{constructor(t){super(t);const e=this;let n=t.topGraph,r=t.bottomGraph;n.position={x:.15,y:.025,width:.8,height:.4},r.position={x:.15,y:.525,width:.8,height:.4};const o=new S(n),s=new S(r);o.subObjects.forEach(function(a){a.addSecondGraph(s)}),s.subObjects.forEach(function(a){a.addSecondGraph(o)}),e.subObjects.push(o),e.subObjects.push(s)}}class Le extends N{constructor(t){super(t);const e=this;let n=t.topGraph,r=t.bottomGraph;n.position={x:.1,y:0,width:.85,height:.4},r.position={x:.1,y:.62,width:.85,height:.38};const o=new S(n),s=new S(r);o.subObjects.forEach(function(a){a.addSecondGraph(s)}),s.subObjects.forEach(function(a){a.addSecondGraph(o)}),e.subObjects.push(o),e.subObjects.push(s),e.aspectRatio=1.3}}let vt=class{constructor(t){}parseSelf(t){return t}parse(t){return t}addSecondGraph(t){}};class $e extends N{constructor(t){super(t);const e=this;let n=t.leftGraph,r=t.rightGraph;const o=.15,s=.65,a=.1,l=.9,c=.3,h=.25;let m=!1;t.hasOwnProperty("leftControls")&&(e.subObjects.push(new vt({position:{x:o,y:l,width:c,height:h},children:[{type:"Controls",def:t.leftControls}]})),m=!0),t.hasOwnProperty("rightControls")&&(e.subObjects.push(new vt({position:{x:s,y:l,width:c,height:h},children:[{type:"Controls",def:t.rightControls}]})),m=!0);let g=m?.5:.9;this.aspectRatio=m?2:4,n.position={x:o,y:a,width:c,height:g},e.subObjects.push(new S(n)),r.position={x:s,y:a,width:c,height:g},e.subObjects.push(new S(r))}}class ke extends N{constructor(t){super(t);const e=this;let n=t.graph,r={position:{x:.05,y:.1,width:.35,height:.7},children:[{type:"GameMatrix",def:t.game}]};n.position={x:.6,y:.1,width:.35,height:.7},e.subObjects.push(new vt(r)),e.subObjects.push(new S(n))}}let bt=class{constructor(t){}parseSelf(t){return t}parse(t){return t}addSecondGraph(t){}};class Me extends N{constructor(t){super(t);const e=this;let n=t.leftGraph,r=t.middleGraph,o=t.rightGraph;const s=.05,a=.35,l=.65,c=.025,h=.65,m=.25,g=.3;let v=!1;t.hasOwnProperty("leftControls")&&(e.subObjects.push(new bt({position:{x:s,y:h,width:m,height:g},children:[{type:"Controls",def:t.leftControls}]})),v=!0),t.hasOwnProperty("middleControls")&&(e.subObjects.push(new bt({position:{x:a,y:h,width:m,height:g},children:[{type:"Controls",def:t.middleControls}]})),v=!0),t.hasOwnProperty("rightControls")&&(e.subObjects.push(new bt({position:{x:l,y:h,width:m,height:g},children:[{type:"Controls",def:t.rightControls}]})),v=!0);let P=v?.5:.9;this.aspectRatio=v?2:4,n.position={x:s,y:c,width:m,height:P},e.subObjects.push(new S(n)),r.position={x:a,y:c,width:m,height:P},e.subObjects.push(new S(r)),o.position={x:l,y:c,width:m,height:P},e.subObjects.push(new S(o))}}class De extends N{constructor(t){super(t);const e=this;let n=t.bigGraph,r=t.topGraph,o=t.bottomGraph;n.position={x:.05,y:.025,width:.5,height:.9},r.position={x:.6,y:.025,width:.35,height:.4},o.position={x:.6,y:.525,width:.35,height:.4},e.subObjects.push(new S(n)),e.subObjects.push(new S(r)),e.subObjects.push(new S(o))}}class Ie extends N{constructor(t){super(t);const e=this;e.aspectRatio=1.6;let n=t.bigGraph,r=t.topGraph,o=t.bottomGraph;r.position={x:.1,y:.05,width:.25,height:.4},o.position={x:.1,y:.538,width:.25,height:.4},n.position={x:.43,y:.05,width:.555,height:.888},e.subObjects.push(new S(n)),e.subObjects.push(new S(r)),e.subObjects.push(new S(o))}}class Ge extends Y{constructor(t){super(t);const e=this;let n=t.graph;n.position={x:.15,y:.025,width:.74,height:.9},e.subObjects.push(new S(n))}}class Re extends Y{constructor(t){super(t);const e=this;let n=t.tree;n.position={x:.15,y:.025,width:.74,height:.9},e.subObjects.push(new jt(n))}}class Be extends Ut{constructor(t){super(t);const e=this;let n=t.graph;n.position={x:.15,y:.025,width:.74,height:.9},e.subObjects.push(new S(n))}}class _e extends Y{constructor(t){super(t);const e=this;let n=t.topLeftGraph,r=t.bottomLeftGraph,o=t.topRightGraph,s=t.bottomRightGraph;const a=.05,l=.55,c=.025,h=.525;n.position={x:a,y:c,width:.4,height:.4},r.position={x:a,y:h,width:.4,height:.4},o.position={x:l,y:c,width:.4,height:.4},s.position={x:l,y:h,width:.4,height:.4},e.subObjects.push(new S(n)),e.subObjects.push(new S(r)),e.subObjects.push(new S(o)),e.subObjects.push(new S(s))}}class ut extends H{constructor(t,e){u(t,{color:"colors.orange"});let n=t.xIntercept,r=t.yIntercept,o=t.slope,s=t.invSlope;t.hasOwnProperty("point")&&t.hasOwnProperty("point2")?(o=y(x(t.point[1],t.point2[1]),x(t.point[0],t.point2[0])),r=x(t.point[1],p(o,t.point[0])),s=y(x(t.point[0],t.point2[0]),x(t.point[1],t.point2[1])),n=x(t.point[0],p(s,t.point[1]))):t.hasOwnProperty("xIntercept")&&t.hasOwnProperty("yIntercept")?(o=R(y(t.yIntercept,t.xIntercept)),s=R(y(t.xIntercept,t.yIntercept))):t.hasOwnProperty("point")&&t.hasOwnProperty("yIntercept")?(o=y(x(t.point[1],t.yIntercept),t.point[0]),s=y(t.point[0],x(t.point[1],t.yIntercept)),n=R(p(r,s))):t.hasOwnProperty("slope")&&t.hasOwnProperty("yIntercept")?(s=j(t.slope),n=R(y(r,o))):t.hasOwnProperty("invSlope")&&t.hasOwnProperty("xIntercept")?(o=j(t.invSlope),r=R(y(n,s))):t.hasOwnProperty("invSlope")&&t.hasOwnProperty("yIntercept")?o=j(t.invSlope):t.hasOwnProperty("slope")&&t.hasOwnProperty("point")?(s=j(t.slope),n=x(t.point[0],y(t.point[1],t.slope)),r=x(t.point[1],p(t.point[0],t.slope))):t.hasOwnProperty("invSlope")&&t.hasOwnProperty("point")?(o=j(t.invSlope),n=x(t.point[0],y(t.point[1],o)),r=x(t.point[1],p(t.point[0],o))):t.hasOwnProperty("slope")?(s=j(t.slope),n=0,r=0):t.hasOwnProperty("yIntercept")?(s=1/0,n=null,r=t.yIntercept,o=0):t.hasOwnProperty("xIntercept")?(s=0,n=t.xIntercept,r=null,o=1/0):(n=0,r=0,o=y(t.point[1],t.point[0]),s=y(t.point[0],t.point[1])),t.univariateFunction={fn:`${r} + (${o})*(x)`,yFn:`${n} + (${s})*(y)`,ind:`((${s} == 0) ? 'y' : 'x')`,samplePoints:2},t.hasOwnProperty("min")&&(t.univariateFunction.min=t.min,delete t.min),t.hasOwnProperty("max")&&(t.univariateFunction.max=t.max,delete t.max),super(t,e);const a=this;if(a.xIntercept=n,a.yIntercept=r,a.slope=o,a.invSlope=s,t.hasOwnProperty("label")&&t.label.hasOwnProperty("r")){let l=d(t);delete l.label,l=u(l,t.label),l=u(l,{fontSize:12,color:t.color,coordinates:Ot(a,l.r,l.center)}),a.subObjects.push(new k(l,e))}}parseSelf(t){let e=this;t=super.parseSelf(t);let n={slope:e.slope.toString(),invSlope:e.invSlope.toString()};return e.xIntercept&&(n.xIntercept=e.xIntercept.toString()),e.yIntercept&&(n.yIntercept=e.yIntercept.toString()),e.xIntercept?e.yIntercept?n.fixedPoint=`(${n.invSlope} == 0 ? (${n.xIntercept})/(1 - ${e.invSlope.toString()}) : (${n.yIntercept})/(1 - ${e.slope.toString()}))`:n.fixedPoint=`((${n.xIntercept})/(1 - ${e.invSlope.toString()}))`:n.fixedPoint=`((${n.yIntercept})/(1 - ${e.slope.toString()}))`,e.pts.forEach(function(r){if(r.hasOwnProperty("r")){const o=Ot(e,r.r,r.center);t.calcs[e.name][r.name]={x:o[0],y:o[1]}}}),t.calcs[e.name]=u(t.calcs[e.name]||{},n),t}}function Pt(i,t){const e=y(O(i.xIntercept,p(i.invSlope,t.yIntercept)),x("1",p(i.invSlope,t.slope))),n=t.yOfX(e);return[e,n]}function Ot(i,t,e){const n=O(1,rt(i.slope));let r=p(2,p(i.slope,i.yIntercept)),o=x(rt(i.yIntercept),rt(t));if(e){const s=e[0],a=e[1]||0;r=x(r,p(2,O(e[0],p(i.slope,a)))),o=O(o,x(O(rt(s),rt(a)),p(2,p(i.yIntercept,a))));const l=de(n,r,o,!0),c=i.yOfX(l);return[l,c]}}class Ne extends E{constructor(t,e){const n=new ut(t.lineDef,e),r=Ot(n,t.radius);u(t,{coordinates:r,positive:!0}),super(t,e),this.subObjects.push(n)}}let Yt=class extends _{constructor(t,e){t=q(t),super(t,e);let n=this;n.type="Contour",n.layer=t.layer||1,t.hasOwnProperty("coordinates")&&n.extractCoordinates(),t.hasOwnProperty("level")||(t.level=t.fn.replace(/\(x\)/g,`(${t.x})`).replace(/\(y\)/g,`(${t.y})`)),n.level=t.level}parseSelf(t){let e=this;return t=super.parseSelf(t),t.calcs.contourLevel=e.level,t}},Te=class extends _{constructor(t,e){u(t,{color:"grey",strokeWidth:.5}),super(t,e);let n=this;n.type="ContourMap",n.layer=t.layer||1,n.subObjects=t.levels.map(function(r){let o=d(t);return delete o.levels,o.level=r,new Yt(o,e)})}},Zt=class extends _{constructor(t,e){u(t,{color:"colors.blue",opacity:.2,rx:1,ry:t.rx}),t=st(t),t=q(t),super(t,e);const n=this;if(n.type="Circle",n.layer=t.layer||0,t.hasOwnProperty("c")?n.extractCoordinates("c"):t.hasOwnProperty("center")?n.extractCoordinates("center"):n.extractCoordinates(),t=zt(t),t.hasOwnProperty("label")){let r=d(t);delete r.label,r=u(r,t.label),r=u(r,{fontSize:10,color:t.color,bgcolor:null}),n.subObjects.push(new k(r,e))}}},Ve=class extends Zt{constructor(t,e){t.hasOwnProperty("radius")&&(t.r=t.radius,delete t.radius),t.hasOwnProperty("r")&&(t.rx=t.r,t.ry=t.r),super(t,e)}},ze=class extends _{constructor(t,e){u(t,{yPixelOffset:40,xPixelOffset:40}),super(t,e);let n=this;n.type="Axis",n.layer=2,t.hasOwnProperty("title")&&t.title!=""&&(t.orient=="bottom"?n.subObjects.push(new k({text:`\\text{${t.title}}`,x:G(e.xScale.min,e.xScale.max),y:e.yScale.min,yPixelOffset:-1*t.yPixelOffset},e)):t.orient=="left"?n.subObjects.push(new k({text:`\\text{${t.title}}`,x:e.xScale.min,y:G(e.yScale.min,e.yScale.max),xPixelOffset:-1*t.xPixelOffset,rotate:90},e)):t.orient=="top"?n.subObjects.push(new k({text:`\\text{${t.title}}`,x:G(e.xScale.min,e.xScale.max),y:e.yScale.min,yPixelOffset:t.yPixelOffset},e)):n.subObjects.push(new k({text:`\\text{${t.title}}`,x:e.xScale.min,y:G(e.yScale.min,e.yScale.max),xPixelOffset:t.xPixelOffset,rotate:270},e)))}};class qe extends B{constructor(t,e){t.endArrow=!0,t.hasOwnProperty("double")&&(t.startArrow=t.double),t.a=t.begin,t.b=t.end,super(t,e)}}class Jt extends H{constructor(t,e){u(t,{name:"angle",color:"colors.grey",coordinates:[0,0],radians:!1,start:0,r:p(.05,x(e.def.xAxis.max,e.def.xAxis.min)),strokeWidth:.75}),t=q(t),t.hasOwnProperty("measure")?t.end=O(t.start,t.measure):t.measure=x(t.end,t.start);let n=t.radians?t.start:p(t.start,.01745329252),r=t.radians?t.measure:p(t.measure,.01745329252),o=t.radians?t.end:p(t.end,.01745329252),s=O(n,p(.5,r));t.parametricFunction={xFunction:O(t.coordinates[0],p(t.r,"cos(t)")),yFunction:O(t.coordinates[1],p(t.r,"sin(t)")),min:n,max:o},super(t,e);let a=this;a.measureDegrees=t.radians?p(t.measure,57.2957795131):t.measure,a.measureRadians=y(r,Math.PI);let l=u(t.label||{},{x:O(t.coordinates[0],p(p(1.7,t.r),`cos(${s})`)),y:O(t.coordinates[1],p(p(1.7,t.r),`sin(${s})`)),fontSize:8,color:t.stroke,bgcolor:"none",radians:!1,show:t.show});const c="`${calcs."+a.name+".measureRadians.toFixed(2)}\\\\pi`",h="`${calcs."+a.name+".measureDegrees.toFixed(0)}^{\\\\circ}`";l.text=l.hasOwnProperty("text")?t.label.text:l.radians?c:h,a.subObjects.push(new k(l,e))}parseSelf(t){let e=this;return t=super.parseSelf(t),t.calcs[e.name]={measureDegrees:e.measureDegrees.toString(),measureRadians:e.measureRadians.toString()},t}}class Xe extends Jt{constructor(t,e){const n=new E(t.pointA,e),r=new E(t.pointB,e),o=new E(t.pointC,e);t.start=`atan2(${n.y} - ${r.y},${n.x} - ${r.x})`,t.end=`atan2(${o.y} - ${r.y},${o.x} - ${r.x})`,t.coordinates=[r.x,r.y],t.radians=!0,u(t,{label:{radians:!1}}),super(t,e);let s=this;if(s.subObjects.push(n),s.subObjects.push(r),s.subObjects.push(o),t.showSegments){let a=d(t),l=d(t);a.a=[r.x,r.y],a.b=[n.x,n.y],delete a.label,s.subObjects.push(new B(a,e)),l.a=[r.x,r.y],l.b=[o.x,o.y],delete l.label,s.subObjects.push(new B(l,e))}}}class Lt extends qt{constructor(t){t.idioms={},t.custom=t.custom||"0";const e=[{PPFlabel:["PPF","PPC"],PPFword:["frontier","curve"],PPFWord:["Frontier","Curve"]},{good1label:["x_1","x","X"],labor1label:["L_1","L_x","L_X"],good1word:["good 1","good X","good X"],good1Word:["Good 1","Good X","Good X"],good2label:["x_2","y","Y"],labor2label:["L_2","L_y","L_Y"],good2word:["good 2","good Y","good Y"],good2Word:["Good 2","Good Y","Good Y"]},{oldValueLabel:["\\ ","_1","0"],newValueLabel:["^\\prime","_2","1"]}];e.forEach(function(n,r){if(r<t.custom.length)for(const o in n)t.idioms[o]=n[o][t.custom[r]];else for(const o in n)t.idioms[o]=n[o][0]}),t.colors=u(t.colors||{},{utility:"purple",mrs:"blue",dispreferred:"red",preferred:"green",offer:"blue",incomeOffer:"orange",demand:"blue",budget:"green",costlier:"red",endowment:"grey",incEffect:"orange",subEffect:"red",production:"blue",mpl:"olive",marginalCost:"orange",marginalRevenue:"olive",supply:"orange",shortRun:"red",longRun:"orange",profit:"green",loss:"red",ppf:"red",mrt:"orange",price:"grey",paretoLens:"'#ffff99'",equilibriumPrice:"green",consumption:"blue",depreciation:"red",savings:"green",tax:"red",player1:"blue",player2:"red",player3:"orange",nature:"green",terminal:"gray"}),super(t),this.idiomMenu=e}}class Qe extends Lt{constructor(t){let e="'#0000AA'",n="'#AA0000'";t.colors={demand:e,supply:e,equilibriumPrice:n},super(t)}}class We extends Lt{constructor(t){let e="'#3f007d'",n="'#084081'",r="'#005824'";t.colors={demand:e,supply:n,equilibriumPrice:r,indifferenceCurve:r,bestResponse:e},super(t)}}class St extends U{constructor(t,e){u(t,{coefficient:1,exponent:.5,wage:1,price:1}),super(t);const n=this;n.coefficient=t.coefficient,n.exponent=t.exponent,n.wage=t.wage,n.price=t.price,n.laborRequirementExponent=j(t.exponent),n.laborRequirementCoefficient=w(t.coefficient,R(n.laborRequirementExponent)),n.marginalProductExponent=x(t.exponent,1),n.marginalProductCoefficient=p(t.exponent,t.coefficient),n.marginalCostCoefficient=p(t.wage,p(n.laborRequirementExponent,n.laborRequirementCoefficient)),n.marginalCostExponent=x(n.laborRequirementExponent,1),n.outputSupplyCoefficient=w(n.marginalCostCoefficient,R(j(n.marginalCostExponent))),n.outputSupplyExponent=j(n.marginalCostExponent),n.laborDemandCoefficient=w(p(n.price,n.marginalProductCoefficient),R(j(n.marginalProductExponent))),n.laborDemandExponent=j(n.marginalProductExponent)}f(t){const e=this;return p(e.coefficient,w(t,e.exponent))}laborRequirement(t){const e=this;return p(e.laborRequirementCoefficient,w(t,e.laborRequirementExponent))}MPL(t){const e=this;return p(e.marginalProductCoefficient,w(t,e.marginalProductExponent))}MRPL(t){const e=this;return p(e.price,e.MPL(t))}cost(t){const e=this;return p(e.wage,e.laborRequirement(t))}marginalCost(t){const e=this;return p(e.marginalCostCoefficient,w(t,e.marginalCostExponent))}laborDemand(t){const e=this;return p(e.laborDemandCoefficient,w(t,e.laborDemandExponent))}optimalOutput(t){const e=this;return p(e.outputSupplyCoefficient,w(t,e.outputSupplyCoefficient))}parseSelf(t){let e=this;return t=super.parseSelf(t),t.calcs[e.name]={coefficient:e.coefficient,exponent:e.exponent,curve:e.f("(x)")},t}}class xt extends ut{constructor(t,e){t=q(t),u(t,{name:"demand",point:[0,t.yIntercept],slope:0,color:"colors.demand",strokeWidth:2,lineStyle:"solid",pts:[]}),t.draggable&&typeof t.xIntercept=="string"?t.drag=[{directions:"x",param:A(t.xIntercept),expression:O(t.xIntercept,"drag.dx")}]:t.draggable&&typeof t.yIntercept=="string"&&(t.drag=[{directions:"y",param:A(t.yIntercept),expression:O(t.yIntercept,"drag.dy")}]),t.hasOwnProperty("price")&&t.pts.push({name:"PQ",y:t.price}),t.hasOwnProperty("surplus")&&!t.hasOwnProperty("price")&&t.surplus.hasOwnProperty("quantity")&&t.pts.push({name:"PQ",x:t.surplus.quantity}),super(t,e);let n=this;if(e){const r=n.subObjects;let o={coordinates:[n.xIntercept,0],color:t.color,r:4};t.draggable&&typeof n.xIntercept=="string"&&(o.drag=[{directions:"x",param:A(n.xIntercept),expression:O(n.xIntercept,"drag.dx")}]),t.hasOwnProperty("xInterceptLabel")&&(o.droplines={vertical:t.xInterceptLabel}),n.xInterceptPoint=new E(o,e);let s={coordinates:[0,n.yIntercept],color:t.color,r:4};if(t.draggable&&typeof n.yIntercept=="string"&&(s.drag=[{directions:"y",param:A(n.invSlope),expression:R(y(n.xIntercept,"max(drag.y,0.01)"))}]),t.hasOwnProperty("yInterceptLabel")&&(s.droplines={horizontal:t.yInterceptLabel}),n.yInterceptPoint=new E(s,e),t.handles&&(r.push(n.xInterceptPoint),r.push(n.yInterceptPoint)),t.hasOwnProperty("marginalRevenue")){let a=u(t.marginalRevenue||{},{color:"colors.marginalRevenue",yIntercept:n.yIntercept,slope:p(2,n.slope),label:{text:"MR",x:p(.6,n.xIntercept)}});n.marginalRevenue=new ut(a,e),n.subObjects.push(n.marginalRevenue)}if(t.hasOwnProperty("surplus")){let a=u(t.surplus||{},{fill:"colors.demand"}),l=a.price||`calcs.${n.name}.PQ.y`,c=a.quantity||`calcs.${n.name}.PQ.x`;a.univariateFunction1={fn:n.def.univariateFunction.fn,min:0,max:c,samplePoints:2},a.univariateFunction2={fn:l,min:0,max:c,samplePoints:2},n.subObjects.push(new z(a,e))}}}}class He extends xt{}class $t extends ut{constructor(t,e){t=q(t),u(t,{name:"supply",color:"colors.supply",strokeWidth:2,lineStyle:"solid",pts:[]}),t.draggable&&typeof t.slope=="string"?t.drag=[{directions:"xy",param:A(t.slope),expression:y(x("drag.y",t.yIntercept),"drag.x")}]:t.draggable&&typeof t.invSlope=="string"?t.drag=[{directions:"xy",param:A(t.invSlope),expression:y("drag.x",x("drag.y",t.yIntercept))}]:t.draggable&&typeof t.yIntercept=="string"&&(t.drag=[{directions:"y",param:A(t.yIntercept),expression:O(t.yIntercept,"drag.dy")}]),t.hasOwnProperty("price")&&t.pts.push({name:"PQ",y:t.price}),super(t,e);let n=this;if(e){const r=n.subObjects;let o={coordinates:[0,n.yIntercept],color:t.color,r:4,show:t.show};if(t.draggable&&typeof n.yIntercept=="string"&&(o.drag=[{directions:"y",param:A(n.yIntercept),expression:O(n.yIntercept,"drag.dy")}]),t.hasOwnProperty("yInterceptLabel")&&(o.droplines={horizontal:t.yInterceptLabel}),n.yInterceptPoint=new E(o,e),t.handles&&r.push(n.yInterceptPoint),t.hasOwnProperty("surplus")){let s=u(t.surplus||{},{fill:"colors.supply"}),a=s.price||`calcs.${n.name}.PQ.y`,l=s.quantity||`calcs.${n.name}.PQ.x`;s.univariateFunction1={fn:n.def.univariateFunction.fn,min:0,max:l,samplePoints:2},s.univariateFunction2={fn:a,min:0,max:l,samplePoints:2},n.subObjects.push(new z(s,e))}}}}class Kt extends $t{constructor(t,e){super(t,e)}}class Ue extends M{constructor(t,e){u(t,{name:"monopoly",showCS:!1,showPS:!1,showProfit:!1,showDWL:!1}),super(t,e);let n=this;t.demand.surplus={show:t.showCS,price:`calcs.${n.name}.P`,quantity:`calcs.${n.name}.Q`},t.cost.surplus={show:t.showPS,price:`calcs.${n.name}.P`,quantity:`calcs.${n.name}.Q`},n.demand=new xt(t.demand,e),n.cost=new Kt(t.cost,e);let r=Pt(n.demand.marginalRevenue,n.cost);n.Q=r[0],n.P=n.demand.yOfX(n.Q),n.MRMC=n.cost.yOfX(n.Q);let o=Pt(n.demand,n.cost);if(n.competitiveQ=o[0],n.competitiveP=n.demand.yOfX(n.competitiveQ),t.hasOwnProperty("showDWL")){let s={show:t.showDWL,fill:"colors.dwl"};s.univariateFunction1={fn:n.demand.def.univariateFunction.fn,min:n.Q,max:n.competitiveQ,samplePoints:2},s.univariateFunction2={fn:n.cost.def.univariateFunction.fn,min:n.Q,max:n.competitiveQ,samplePoints:2},n.subObjects.push(new z(s,e))}n.subObjects.push(this.demand),n.subObjects.push(this.cost)}parseSelf(t){let e=this;return t=super.parseSelf(t),t.calcs[e.name]={Q:e.Q.toString(),P:e.P.toString(),competitiveQ:e.competitiveQ.toString(),competitiveP:e.competitiveP.toString()},t}}class Ye extends M{constructor(t,e){super(t,e),this.subObjects.push(new J({clipPathName:t.bundleA+"_IC_above",clipPathName2:t.bundleB+"_IC_above",x1:e.def.xAxis.min,x2:e.def.xAxis.max,y1:e.def.yAxis.min,y2:e.def.yAxis.max,fill:"colors.paretoLens",opacity:"0.8",show:t.show},e))}}function gt(i,t){if(i.hasOwnProperty("budgetLineObject"))return i.budgetLineObject;if(i.hasOwnProperty("budgetLine")){let e=JSON.parse(JSON.stringify(i.budgetLine));return e.show=e.show||i.show,e.hasOwnProperty("m")||(i.hasOwnProperty("point")&&i.point.length==2&&(e.point=i.point),i.hasOwnProperty("coordinates")&&i.coordinates.length==2&&(e.point=i.coordinates),i.hasOwnProperty("x")&&i.hasOwnProperty("y")&&(e.x=i.x,e.y=i.y)),e.color=e.color||i.color,new D(e,t)}}class D extends B{constructor(t,e){t=q(t),t.name=t.name||"BL"+L(5),t.hasOwnProperty("m")||(t.hasOwnProperty("x")&&t.hasOwnProperty("y")&&(t.point=[t.x,t.y]),t.hasOwnProperty("point")&&t.point.length==2&&(t.m=O(p(t.p1,t.point[0]),p(t.p2,t.point[1]))));const n=y(t.m,t.p1),r=y(t.m,t.p2),o=y(t.p1,t.p2),s={x:t.x,y:t.y};t.inMap&&(t.strokeWidth=1,t.lineStyle="dotted",t.layer=0,t.handles=!1,t.draggable=!1),u(t,{a:[`calcs.${t.name}.xIntercept`,0],b:[0,`calcs.${t.name}.yIntercept`],color:"colors.budget",strokeWidth:2,lineStyle:"solid",buyOnly:!1,sellOnly:!1}),t.sellOnly&&(t.a=[t.x,t.y]),t.buyOnly&&(t.b=[t.x,t.y]),t.draggable&&typeof t.m=="string"&&(t.drag=[{directions:"xy",param:A(t.m),expression:O(p("drag.x",t.p1),p("drag.y",t.p2))}]),t.label=="none"?delete t.label:t.inMap||(t.label=u(t.label||{},{text:"BL",location:t.sellOnly?.1:.9})),super(t,e);let a=this;if(a.p1=t.p1,a.p2=t.p2,a.m=t.m,a.xIntercept=n,a.yIntercept=r,a.priceRatio=o,a.point=t.point,a.endowment=s,e){const l=a.subObjects;let c={coordinates:[`calcs.${a.name}.xIntercept`,0],color:t.stroke,r:4};t.draggable&&typeof t.p1=="string"&&(c.drag=[{directions:"x",param:A(t.p1),expression:y(`calcs.${a.name}.m`,"drag.x")}]),t.hasOwnProperty("xInterceptLabel")&&(c.droplines={vertical:t.xInterceptLabel}),a.xInterceptPoint=new E(c,e);let h={coordinates:[0,`calcs.${a.name}.yIntercept`],color:t.stroke,r:4};t.draggable&&typeof t.p2=="string"&&(h.drag=[{directions:"y",param:A(t.p2),expression:y("calcs."+a.name+".m","drag.y")}]),t.hasOwnProperty("yInterceptLabel")&&(h.droplines={horizontal:t.yInterceptLabel}),a.yInterceptPoint=new E(h,e),a.budgetSetArea=new z({fill:"colors.budget",univariateFunction1:{fn:`calcs.${a.name}.yIntercept - calcs.${a.name}.priceRatio*(x)`,samplePoints:2,max:`calcs.${a.name}.xIntercept`},show:t.set},e),a.costlierArea=new z({fill:"colors.costlier",univariateFunction1:{fn:`calcs.${a.name}.yIntercept - calcs.${a.name}.priceRatio*(x)`,samplePoints:2},show:t.costlier,above:!0},e),t.handles&&(l.push(a.xInterceptPoint),l.push(a.yInterceptPoint)),t.set&&l.push(a.budgetSetArea),t.costlier&&l.push(a.costlierArea)}}cost(t){return`((${this.p1})*(${t.x}) + (${this.p2})*(${t.y}))`}parseSelf(t){let e=this;return t=super.parseSelf(t),t.calcs[e.name]={xIntercept:e.xIntercept.toString(),yIntercept:e.yIntercept.toString(),m:e.m.toString(),p1:e.p1.toString(),p2:e.p2.toString(),priceRatio:e.priceRatio.toString(),endowment:e.endowment.toString()},t}}function Ze(i,t){if(i.hasOwnProperty("indifferenceCurveObject"))return i.indifferenceCurveObject;if(i.hasOwnProperty("indifferenceCurve")){let e=d(i.indifferenceCurve);return e.show=e.show||i.show,e.name=i.name+"_IC",new kt(e,t)}}class kt extends M{constructor(t,e){t.inMap&&(t.strokeWidth=1,t.color="lightgrey",t.layer=0),u(t,{strokeWidth:2,color:"colors.utility",layer:1,showPreferred:!1,showDispreferred:!1,inMap:!1,showMapLevels:!1}),t.inMap?t.showMapLevels&&(t.label=u(t.label||{},{fontSize:8,x:p(.98,e.xScale.max),text:`${t.level}.toFixed(0)`,color:t.color,bgcolor:null})):t.label=u(t.label||{},{x:p(.95,e.xScale.max),text:"U",color:t.color,bgcolor:null,position:"bl"}),super(t,e);let n=this;const r=tt(t);if(n.utilityFunction=r,n.subObjects=n.subObjects.concat(r.levelCurve(t,e)),!t.inMap){if(t.showPreferred){let o=d(t);o.fill=t.color||"colors.preferred",o.show=t.showPreferred,n.subObjects=n.subObjects.concat(r.areaAboveLevelCurve(o,e))}if(t.showDispreferred){let o=d(t);o.fill="colors.dispreferred",o.show=t.showDispreferred,n.subObjects=n.subObjects.concat(r.areaBelowLevelCurve(o,e))}}}}class Je extends M{constructor(t,e){super(t,e),this.subObjects=t.levels.map(function(n){let r=d(t);return r.inMap=!0,delete r.levels,Array.isArray(n)?r.point=n:r.level=n,new kt(r,e)})}}function W(i){if(i!=null){if(i=Vt(i),i.type=="CobbDouglas")return new ie(i.def);if(i.type=="Substitutes"||i.type=="PerfectSubstitutes")return new te(i.def);if(i.type=="Complements"||i.type=="PerfectComplements")return new re(i.def);if(i.type=="Concave")return new ne(i.def);if(i.type=="Quasilinear")return new ee(i.def);if(i.type=="CESFunction"||i.type=="CES")return new oe(i.def)}}function tt(i){return i.utilityFunctionObject||W(i.utilityFunction)}class pt extends E{constructor(t,e){u(t,{label:{text:"X"},droplines:{vertical:"x_1",horizontal:"x_2"},color:"colors.utility"}),st(t),super(t,e);const n=this;n.budgetLine=gt(t,e),n.budgetLine&&n.subObjects.push(n.budgetLine),n.utilityFunction=tt(t),n.utilityFunction&&(n.subObjects.push(n.utilityFunction),t.hasOwnProperty("indifferenceCurve")&&(t.indifferenceCurve.level=`calcs.${n.name}.level`,t.indifferenceCurve.utilityFunction=t.utilityFunction,n.subObjects.push(Ze(t,e))))}parseSelf(t){let e=this;return t=super.parseSelf(t),t.calcs[e.name]={x:e.x,y:e.y,level:e.utilityFunction?e.utilityFunction.value([e.x,e.y]):"",cost:e.budgetLine?e.budgetLine.cost(e):"",mrs:e.utilityFunction?R(e.utilityFunction.levelCurveSlope([e.x,e.y])):""},t}}class at extends pt{constructor(t,e){const n=gt(t,e),r=tt(t),o=r.optimalBundle(n);u(t,{coordinates:o,label:{text:"X^*"},color:"demand",droplines:{vertical:"x_1^*",horizontal:"x_2^*"},indifferenceCurve:{}}),n.hasOwnProperty("endowment")&&(n.def.sellOnly&&(t.show=`(${t.show||!0} && (${o[0]} < ${n.endowment.x}))`),n.def.buyOnly&&(t.show=`(${t.show||!0} && (${o[0]} > ${n.endowment.x}))`)),t.budgetLineObject=n,super(t,e),this.level=r.value(o)}}class Ke extends at{constructor(t,e){if(t.hasOwnProperty("utilityFunction")&&t.hasOwnProperty("budgetLine")){const n=W(t.utilityFunction),r=new D(t.budgetLine,e);u(t,{coordinates:n.lagrangeBundle(r),color:"colors.incomeOffer",show:n.cornerCondition(r),label:{text:"X^*_L"}})}super(t,e)}}class tn extends at{constructor(t,e){const n=tt(t),r=t.prices[0],o=t.prices[1],s=n.expenditure(t.level,t.prices);delete t.prices,delete t.level,t.budgetLine=u(t.budgetLine||{},{p1:r,p2:o,m:s}),super(t,e)}}class en extends at{constructor(t,e){const n=gt(t,e),r=tt(t);t.budgetLine=t.budgetLine||{},t.hasOwnProperty("p1")&&(t.budgetLine.p1=t.p1,delete t.budgetLine.m),t.hasOwnProperty("p2")&&(t.budgetLine.p2=t.p2,delete t.budgetLine.m),t.budgetLine.label=u(t.budgetLine.label||{},{text:"BL_D"}),t.budgetLine.point=r.optimalBundle(n),delete t.budgetLineObject,super(t,e)}}class nn extends at{constructor(t,e){const n=gt(t,e),r=tt(t),o=t.hasOwnProperty("p1")?t.p1:t.budgetLine.p1,s=t.hasOwnProperty("p2")?t.p2:t.budgetLine.p2,a=r.value(r.optimalBundle(n));t.budgetLine.p1=o,t.budgetLine.p2=s,t.budgetLine.m=r.expenditure(a,[o,s]),t.budgetLine.label=u(t.budgetLine.label||{},{text:"BL_C"}),t.coordinates=r.lowestCostBundle(a,[o,s]),delete t.budgetLineObject,super(t,e)}}class rn extends pt{constructor(t,e){const n=tt(t),r=t.prices[0],o=t.prices[1];t.coordinates=[n.laborRequirement(t.level,t.capital),t.capital],t.budgetLine=u(t.budgetLine||{},{p1:r,p2:o}),t.budgetLine.label=u(t.budgetLine.label||{},{text:"c_s(y)"}),delete t.budgetLineObject,super(t,e)}}class on extends at{constructor(t,e){const n=new pt(t.agentA,e),r=new pt(t.agentB,e);let o;if(t.agentA.utilityFunction.type=="CobbDouglas"&&t.agentB.utilityFunction.type=="CobbDouglas"){let s=function(l){return p(l.y,l.utilityFunction.alpha)},a=function(l){return p(l.x,x(1,l.utilityFunction.alpha))};o=y(O(s(n),s(r)),O(a(n),a(r)))}u(t,{label:{text:"E"},color:"colors.budget"}),t.utilityFunctionObject=n.utilityFunction,t.budgetLine={p1:o,p2:1,point:[n.x,n.y]},super(t,e)}}class sn extends H{constructor(t,e){const n=t.a,r=t.b,o=p(n,r),s=p(x(n,o),t.totalGood1),a=p(x(r,o),t.totalGood2),l=x(r,n),c=`${a}*(x)/(${s} + ${l}*(x))`;t.univariateFunction={fn:c},u(t,{interpolation:"curveMonotoneX",color:"colors.budget"}),super(t,e),this.fnString=c}parseSelf(t){let e=this;return t=super.parseSelf(t),t.calcs.cc=e.fnString,t}}class an extends H{constructor(t,e){t=q(t),u(t,{name:"ppf",color:"colors.supply",strokeWidth:2,lineStyle:"solid",labor:100,L1:50,p1:1,p2:1,max1:100,max2:100,curvature:.5}),t.linear&&(t.curvature=1);const n=y(t.max1,w(t.labor,t.curvature)),r=y(t.max2,w(t.labor,t.curvature)),o=new St({name:t.name+"_prodFn1",coefficient:n,exponent:t.curvature}),s=new St({name:t.name+"_prodFn2",coefficient:r,exponent:t.curvature});if(t.parametricFunction={xFunction:o.f("(t)"),yFunction:s.f(x(t.labor,"(t)")),max:t.labor},t.draggable){const m=O(o.laborRequirement("drag.x"),s.laborRequirement("drag.y"));t.drag=[{directions:"xy",param:A(t.max1),expression:o.f(m)},{directions:"xy",param:A(t.max2),expression:s.f(m)}]}super(t,e);let a=this;a.labor=t.labor,a.prodFn1=o,a.prodFn2=s,a.subObjects.push(o),a.subObjects.push(s),a.L1=t.L1,a.L2=x(t.labor,t.L1),a.y1=a.prodFn1.f(a.L1),a.y2=a.prodFn2.f(a.L2);const l=y(t.max2,t.max1),c=y(a.L2,t.L1),h=y(t.p1,t.p2);if(t.curvature==1)a.mrt=l,a.optimalL1=`((${l} > ${h}) ? 0 : ${a.labor})`,a.optimalL1=`((${l} > ${h}) ? ${a.labor} : 0)`;else{a.mrt=p(l,w(c,x(t.curvature,1)));const m=w(y(l,h),j(x(t.curvature,1)));a.optimalL1=p(y(m,O(1,m)),a.labor),a.optimalL2=p(y(1,O(1,m)),a.labor)}if(a.optimaly1=a.prodFn1.f(a.optimalL1),a.optimaly2=a.prodFn2.f(a.optimalL2),e){const m=a.subObjects;let g={coordinates:[t.max1,0],fill:t.stroke,r:4};t.draggable&&typeof t.max1=="string"&&(g.drag=[{directions:"x",param:A(t.max1),expression:O(t.max1,"drag.dx")}]),t.hasOwnProperty("xInterceptLabel")&&(g.droplines={vertical:t.xInterceptLabel}),a.xInterceptPoint=new E(g,e);let v={coordinates:[0,t.max2],fill:t.stroke,r:4};t.draggable&&typeof t.max2=="string"&&(v.drag=[{directions:"y",param:A(t.max2),expression:O(t.max2,"drag.dy")}]),t.hasOwnProperty("yInterceptLabel")&&(v.droplines={horizontal:t.yInterceptLabel}),a.yInterceptPoint=new E(v,e),t.handles&&(m.push(a.xInterceptPoint),m.push(a.yInterceptPoint))}}parseSelf(t){let e=this;return t=super.parseSelf(t),t.calcs[e.name]={L1:e.L1,L2:e.L2,y1:e.y1,y2:e.y2,optimalL1:e.optimalL1,optimalL2:e.optimalL2,optimaly1:e.optimaly1,optimaly2:e.optimaly2,mrt:e.mrt},t}}class ln extends M{constructor(t,e){u(t,{name:"equilibrium",showCS:!1,showPS:!1}),super(t,e);let n=this;t.demand.price=`calcs.${n.name}.P`,t.supply.price=`calcs.${n.name}.P`,n.demand=new xt(t.demand,e),n.supply=new $t(t.supply,e),n.subObjects.push(this.demand),n.subObjects.push(this.supply);let r=Pt(n.demand,n.supply);n.Q=r[0],n.P=r[1],e&&t.hasOwnProperty("equilibrium")&&(t.equilibrium=u(t.equilibrium,{color:"colors.equilibriumPrice",x:n.Q,y:n.P,droplines:{vertical:"Q^*",horizontal:"P^*"}}),n.subObjects.push(new E(t.equilibrium,e)))}parseSelf(t){let e=this;return t=super.parseSelf(t),t.calcs[e.name]={Q:e.Q.toString(),P:e.P.toString()},t}}class dt extends H{constructor(t,e){t=q(t),u(t,{name:"constElasticityCurve"+L(5),color:"colors.demand",strokeWidth:2,lineStyle:"solid",show:!0}),t.hasOwnProperty("elasticity")&&(t.elasticity=t.elasticity.toString()),t.hasOwnProperty("normalizedElasticity")&&(t.normalizedElasticity=t.normalizedElasticity.toString());let n=d(t);n.fn=p("calcs."+t.name+".coefficient",w("(y)","calcs."+n.name+".elasticity")),n.ind="y",n.samplePoints=500,n.show="(("+t.show+") && !(calcs. "+t.name+".elastic))";let r=d(t);r.name=t.name+"inverse",r.fn=p("calcs."+r.name+".coefficient",w("(x)","calcs."+r.name+".elasticity")),r.samplePoints=500,r.ind="x",r.show="(("+t.show+") && (calcs. "+t.name+".elastic))";let o=d(t.point||{});if(o.color=o.color||t.color,o.show=o.show||t.show,t.hasOwnProperty("point2")){let l=d(t.point2);l.color=l.color||t.color,l.show=l.show||t.show}super(n,e);let s=this;s.subObjects.push(new H(r,e));const a=new E(o,e);if(s.subObjects.push(a),t.hasOwnProperty("point2")){let l=t.point2;l.color=l.color||t.color;const c=new E(l,e),h=y(a.x,c.x),m=y(a.y,c.y);s.elasticity=y("log"+h,"log"+m),s.invElasticity=y("log"+m,"log"+h),s.perfectlyElastic="("+a.y+" == "+c.y+")",s.perfectlyInelastic="("+a.x+" == "+c.x+")",s.subObjects.push(c)}else if(t.hasOwnProperty("normalizedElasticity")){const l="(abs("+t.normalizedElasticity+"))";s.elasticity=y(t.normalizedElasticity,"(1 - "+l+")"),s.invElasticity=y("(1 - "+l+")",t.normalizedElasticity),s.perfectlyElastic="("+l+" == 1)",s.perfectlyInelastic="("+t.normalizedElasticity+" == 0)"}else s.elasticity=t.elasticity,s.invElasticity=j(t.elasticity),s.perfectlyInelastic="("+t.elasticity+" == 0)",s.perfectlyElastic="false";s.coefficient=y(a.x,w(a.y,s.elasticity)),s.invCoefficient=y(a.y,w(a.x,s.invElasticity)),s.absElasticity="(abs("+s.elasticity+"))",s.elastic="("+s.absElasticity+" > 1)",s.unitElastic="("+s.absElasticity+" == 1)",s.inelastic="("+s.absElasticity+" < 1)"}parseSelf(t){let e=this;return t=super.parseSelf(t),t.calcs[e.name]={elasticity:e.elasticity,coefficient:e.coefficient,elastic:e.elastic,unitElastic:e.unitElastic,inelastic:e.inelastic,perfectlyElastic:e.perfectlyElastic,perfectlyInelastic:e.perfectlyInelastic},t.calcs[e.name+"inverse"]={elasticity:e.invElasticity,coefficient:e.invCoefficient},t}}class cn extends M{constructor(t,e){super(t,e);const n=this;n.name=t.name;const r="(calcs."+t.curve1+".coefficient)",o="(calcs."+t.curve1+".elasticity)",s="(calcs."+t.curve2+".coefficient)",a="(calcs."+t.curve2+".elasticity)",l="(calcs."+t.curve1+"inverse.coefficient)",c="(calcs."+t.curve1+"inverse.elasticity)",h="(calcs."+t.curve2+"inverse.coefficient)",m="(calcs."+t.curve2+"inverse.elasticity)",g=w(y(r,s),j(x(a,o))),v=p(r,w(g,o));n.Pdirect=g,n.Qcalc=v;const P=w(y(l,h),j(x(m,c))),$=p(l,w(P,c));n.Qdirect=P,n.Pcalc=$;const b="("+p(o,a)+" == 0)";n.Q="("+b+" ? "+v+" : "+P+")",n.P="("+b+" ? "+g+" : "+$+")"}parseSelf(t){let e=this;return t=super.parseSelf(t),t.calcs[e.name]={Pdirect:e.Pdirect,Pcalc:e.Pcalc,Qdirect:e.Qdirect,Qcalc:e.Qcalc,Q:e.Q,P:e.P},t}}class un extends M{constructor(t,e){u(t,{name:"equilibrium",showCS:!1,showPS:!1}),super(t,e);let n=this;t.equilibrium.color=t.equilibrium.color||"colors.green";const r=new E(t.equilibrium,e);n.Q=r.x,n.P=r.y,t.demand.point=t.equilibrium,t.demand.name=t.name+"dem",t.demand.color="colors.demand";const o=new dt(t.demand,e);n.subObjects.push(o),t.supply.point=t.equilibrium,t.supply.name=t.name+"sup",t.supply.color="colors.supply";const s=new dt(t.supply,e);n.subObjects.push(s)}parseSelf(t){let e=this;return t=super.parseSelf(t),t.calcs[e.name]={Q:e.Q.toString(),P:e.P.toString()},t}}class pn extends M{constructor(t,e){const n=W(t.utilityFunction),r=new D(t.budgetLine,e);u(t,{stroke:"colors.demand",strokeWidth:2}),super(t,e),this.subObjects=n.demandCurve(r,t.good,t,e)}}class hn extends E{constructor(t,e){if(t.hasOwnProperty("utilityFunction")&&t.hasOwnProperty("budgetLine")){const n=W(t.utilityFunction),r=new D(t.budgetLine,e);u(t,{coordinates:[n.quantityDemanded(r,t.good),r["p"+t.good]],fill:"colors.demand",label:{text:`x_${t.good}(p_${t.good}|p_${3-t.good},m)`},droplines:{vertical:`x_${t.good}^*`}})}super(t,e)}}class yn extends M{constructor(t,e){const n=W(t.utilityFunction),r=new D(t.budgetLine,e);u(t,{color:"colors.demand",strokeWidth:2}),super(t,e),this.subObjects=n.netDemandCurve(r,t.good,t,e)}}class mn extends E{constructor(t,e){if(t.hasOwnProperty("utilityFunction")&&t.hasOwnProperty("budgetLine")){const n=W(t.utilityFunction),r=new D(t.budgetLine,e);u(t,{coordinates:[x(n.quantityDemanded(r,t.good),r.point[t.good-1]),r["p"+t.good]],fill:"colors.demand",label:{text:`d_${t.good}(p_${t.good}|p_${3-t.good})`},droplines:{vertical:`d_${t.good}^*`}})}super(t,e)}}class xn extends M{constructor(t,e){const n=W(t.utilityFunction),r=new D(t.budgetLine,e);u(t,{color:"colors.supply",strokeWidth:2}),super(t,e),this.subObjects=n.netSupplyCurve(r,t.good,t,e)}}class gn extends E{constructor(t,e){if(t.hasOwnProperty("utilityFunction")&&t.hasOwnProperty("budgetLine")){const n=W(t.utilityFunction),r=new D(t.budgetLine,e);u(t,{coordinates:[x(r.point[t.good-1],n.quantityDemanded(r,t.good)),r["p"+t.good]],fill:"colors.supply",label:{text:`s_${t.good}(p_${t.good}|p_${3-t.good})`},droplines:{vertical:`s_${t.good}^*`}})}super(t,e)}}class bn extends M{constructor(t,e){const n=W(t.utilityFunction),r=new D(t.budgetLine,e);u(t,{stroke:"colors.offer",strokeWidth:2}),super(t,e),this.subObjects=n.priceOfferCurve(r,t.good,t.min,t.max,t,e)}}class wn extends jt{constructor(t){super(t)}}class Mt{constructor(t){}parseSelf(t){return t}parse(t){return t}addSecondGraph(t){}}class vn extends N{constructor(t){super(t);const e=this;let n=t.agentA,r=t.agentB,o=.738,s=.8;this.aspectRatio=2,n.position={x:.15,y:.1,width:o,height:s},r.position={x:.15+o,y:.1+s,width:-1*o,height:-1*s},n.xAxis.max=r.xAxis.max=t.totalGood1,n.yAxis.max=r.yAxis.max=t.totalGood2,r.xAxis.orient="top",r.yAxis.orient="right",e.subObjects.push(new S(n)),e.subObjects.push(new S(r))}}class Pn extends Y{constructor(t){super(t);const e=this;let n=t.agentA,r=t.agentB,o=.74,s=.9;this.aspectRatio=1.22,n.position={x:.15,y:.025,width:o,height:s},r.position={x:.15+o,y:.025+s,width:-1*o,height:-1*s},n.xAxis.max=r.xAxis.max=t.totalGood1,n.yAxis.max=r.yAxis.max=t.totalGood2,r.xAxis.orient="top",r.yAxis.orient="right",e.subObjects.push(new S(n)),e.subObjects.push(new S(r))}}class On extends N{constructor(t){super(t);const e=this;let n=t.agentA,r=t.agentB,o=t.sidebar,s=.738,a=.8;this.aspectRatio=2,n.position={x:.15,y:.1,width:s,height:a},r.position={x:.15+s,y:.1+a,width:-1*s,height:-1*a},n.xAxis.max=r.xAxis.max=t.totalGood1,n.yAxis.max=r.yAxis.max=t.totalGood2,r.xAxis.orient="top",r.yAxis.orient="right",e.subObjects.push(new S(n)),e.subObjects.push(new S(r)),e.subObjects.push(new Mt(o))}}class Sn extends Y{constructor(t){super(t);const e=this;let n=t.agentA,r=t.agentB,o=t.graph1,s=t.graph2,a=t.sidebar,l=.738,c=.9;t.totalGood1>t.totalGood2&&(c=t.totalGood2*c/t.totalGood1),t.totalGood2>t.totalGood1&&(c=t.totalGood1*l/t.totalGood2),n.position={x:.15,y:.05,width:l,height:c},r.position={x:.15+l,y:.05+c,width:-1*l,height:-1*c},o.position={x:.1,y:c+.15,width:.35,height:.85-c},s.position={x:.6,y:c+.15,width:.35,height:.85-c},n.xAxis.max=r.xAxis.max=t.totalGood1,n.yAxis.max=r.yAxis.max=t.totalGood2,r.xAxis.orient="top",r.yAxis.orient="right",e.subObjects.push(new S(r)),e.subObjects.push(new S(n)),e.subObjects.push(new S(o)),e.subObjects.push(new S(s)),e.subObjects.push(new Mt(a))}}class dn extends Y{constructor(t){super(t);const e=this;let n=t.agentA,r=t.agentB,o=t.graph,s=t.sidebar,a=.738,l=.9;t.totalGood1>t.totalGood2&&(l=t.totalGood2*l/t.totalGood1),t.totalGood2>t.totalGood1&&(l=t.totalGood1*a/t.totalGood2),n.position={x:.15,y:.05,width:a,height:l},r.position={x:.15+a,y:.05+l,width:-1*a,height:-1*l},o.position={x:.15,y:l+.15,width:a,height:.85-l},n.xAxis.max=r.xAxis.max=t.totalGood1,n.yAxis.max=r.yAxis.max=t.totalGood2,r.xAxis.orient="top",r.yAxis.orient="right",e.subObjects.push(new S(r)),e.subObjects.push(new S(n)),e.subObjects.push(new S(o)),e.subObjects.push(new Mt(s))}}class et extends U{constructor(t){u(t,{name:L(10)}),super(t);let e=this;e.interpolation="curveMonotoneX",t.hasOwnProperty("alpha")?(e.alpha=t.alpha,e.exponents=t.exponents||[t.alpha,x(1,t.alpha)],e.coefficients=t.coefficients||[t.alpha,x(1,t.alpha)]):t.hasOwnProperty("exponents")?(e.exponents=t.exponents,e.alpha=y(e.exponents[0],O(e.exponents[0],e.exponents[1])),e.coefficients=t.coefficients):t.hasOwnProperty("coefficients")&&(e.exponents=t.coefficients,e.coefficients=t.coefficients,e.alpha=y(e.coefficients[0],O(e.coefficients[0],e.coefficients[1])))}value(t){return null}extractLevel(t){const e=this;if(t.hasOwnProperty("level")&&t.level!=null)return ct(t.level);if(t.hasOwnProperty("point")&&t.point!=null)return e.value(t.point);if(t.hasOwnProperty("budgetLine")){const n=new D(t.budgetLine,null);return e.value(e.optimalBundle(n))}}levelSet(t){return[]}levelCurve(t,e){return t.interpolation=this.interpolation,nt(this.levelSet(t),t,e)}levelCurveSlope(t){return null}areaBelowLevelCurve(t,e){const n=this;n.fillBelowRect=null,t.interpolation=n.interpolation;const r=n.levelSet(t);let o=[];return r.forEach(function(s){let a=d(t);a.univariateFunction1=s,o.push(new z(a,e))}),n.fillBelowRect&&(n.fillBelowRect.show=t.show,n.fillBelowRect.fill=t.fill,o.push(new J(n.fillBelowRect,e))),o}areaAboveLevelCurve(t,e){const n=this;n.fillAboveRect=null,t.interpolation=n.interpolation;const r=n.levelSet(t);let o=[];r.forEach(function(a){let l=d(t);l.univariateFunction1=a,l.above=!0,o.push(new z(l,e))}),n.fillAboveRect&&(n.fillAboveRect.show=t.show,n.fillAboveRect.fill=t.fill,n.fillAboveRect.inDef=!0,o.push(new J(n.fillAboveRect,e)));const s=t.hasOwnProperty("name")?t.name+"_above":L(10);return[new J({clipPathName:s,x1:e.def.xAxis.min,x2:e.def.xAxis.max,y1:e.def.yAxis.min,y2:e.def.yAxis.max,fill:t.fill,show:t.show},e),new ot({name:s,paths:o},e)]}lowestCostBundle(t,e){return[]}cornerCondition(t){return"false"}lagrangeBundle(t){return[]}optimalBundle(t){return[]}quantityDemanded(t,e){return this.optimalBundle(t)[e-1]}priceOfferFunction(t,e,n,r,o){const s=this;let a;t.hasOwnProperty("point")&&t.point!=null?(n=1e-4,r=.9999,a={p1:"(t)",p2:"1 - (t)",m:`${t.point[0]}*(t) + ${t.point[1]}*(1-(t))`}):a=e==1?{p1:"(t)",p2:t.p2,m:t.m}:{p1:t.p1,p2:"(t)",m:t.m};const l=s.optimalBundle(new D(a,o));return[{xFunction:l[0],yFunction:l[1],min:n,max:r,samplePoints:200,parametric:!0}]}priceOfferCurve(t,e,n,r,o,s){const a=this;return o.interpolation="curveMonotoneX",nt(a.priceOfferFunction(t,e,n,r,s),o,s)}demandFunction(t,e,n){const r=this,o=e==1?{p1:"(y)",p2:t.p2,m:t.m}:{p1:t.p1,p2:"(y)",m:t.m};return[{fn:r.quantityDemanded(new D(o,n),e),ind:"y",samplePoints:30}]}demandCurve(t,e,n,r){const o=this;return n.interpolation="curveMonotoneX",nt(o.demandFunction(t,e,r),n,r)}endowmentDemandFunction(t,e,n){const r=this;let o="",s="",a="";const l=t.point[0],c=t.point[1];return e==2?(a=r.optimalBundle(new D({p1:t.p1,p2:"(y)",m:`(${l}*${t.p1} + ${c}*(y))`},n))[1],o=x(a,c),s=x(c,a)):(a=r.optimalBundle(new D({p1:"(y)",p2:t.p2,m:`(${l}*(y) + ${c}*${t.p2})`},n))[0],o=x(a,l),s=x(l,a)),{grossDemand:[{fn:a,ind:"y"}],netDemand:[{fn:o,ind:"y"}],netSupply:[{fn:s,ind:"y"}]}}grossDemandCurve(t,e,n,r){const o=this;return n.interpolation="curveMonotoneX",nt(o.endowmentDemandFunction(t,e,r).grossDemand,n,r)}netDemandCurve(t,e,n,r){const o=this;return n.interpolation="curveMonotoneX",nt(o.endowmentDemandFunction(t,e,r).netDemand,n,r)}netSupplyCurve(t,e,n,r){const o=this;return n.interpolation="curveMonotoneX",nt(o.endowmentDemandFunction(t,e,r).netSupply,n,r)}indirectUtility(t,e){return this.extractLevel({budgetLine:{p1:e[0],p2:e[1],m:t}})}expenditure(t,e){const n=this.lowestCostBundle(t,e);return O(p(n[0],e[0]),p(n[1],e[1]))}laborRequirement(t,e){}}class te extends et{constructor(t){super(t);let e=this;this.interpolation="curveLinear",t.hasOwnProperty("alpha")&&(e.coefficients=[t.alpha,x(1,t.alpha)])}value(t){const e=this.coefficients;return`((${t[0]})*(${e[0]})+(${t[1]})*(${e[1]}))`}levelSet(t){const e=this.coefficients;return[{fn:`(${t.level||this.value(t.point)} - (${e[0]})*(x))/(${e[1]})`,ind:"x",samplePoints:2}]}optimalBundle(t){const e=this.coefficients,n=`((${e[0]})*(${t.p2}) < (${e[1]})*(${t.p1}))`;return[`${n} ? 0 : ${t.xIntercept}`,`${n} ? ${t.yIntercept} : 0`]}}class ee extends et{value(t){return`(${this.coefficients[0]}*log(${t[0]})+${t[1]})`}levelSet(t){const e=this.coefficients;return[{fn:`((${this.extractLevel(t)})-(${e[0]})*log((x)))`,ind:"x",samplePoints:100}]}cornerCondition(t){return`(${this.lagrangeBundle(t)[1]} < 0)`}lagrangeBundle(t){const e=this.coefficients;return[y(p(e[0],t.p2),t.p1),x(t.yIntercept,e[0])]}optimalBundle(t){const e=this.lagrangeBundle(t),n=this.cornerCondition(t);return[`(${n} ? ${t.xIntercept} : ${e[0]})`,`(${n} ? 0 : ${e[1]})`]}}class ne extends et{value(t){const e=this.coefficients;return`(${e[0]})*(${t[0]})^2+(${e[1]})*(${t[1]})^2`}levelSet(t){const e=this.coefficients,n=t.level||this.value(t.point),r=`((${n})/(${e[0]}+${e[1]}))^(0.5)`;return this.fillAboveRect={x1:r,x2:50,y1:r,y2:50,show:t.show},[{fn:`((${n}-(${e[1]})*(y)*(y))/(${e[0]}))^(0.5)`,ind:"y",min:0,max:r,samplePoints:30},{fn:`((${n}-(${e[0]})*(x)*(x))/(${e[1]}))^(0.5)`,ind:"x",min:0,max:r,samplePoints:30}]}}class re extends et{constructor(t){super(t);let e=this;e.interpolation="curveLinear",t.hasOwnProperty("alpha")&&(e.coefficients=[y(.5,t.alpha),y(.5,x(1,t.alpha))])}value(t){const e=this.coefficients;return`(min((${t[0]})*(${e[0]}),(${t[1]})*(${e[1]})))`}levelSet(t){const e=this.coefficients,n=t.level||this.value(t.point),r=y(n,e[0]),o=y(n,e[1]);return this.fillBelowRect={x1:0,x2:r,y1:0,y2:o,show:t.show},[{fn:y(n,e[1]),ind:"x",min:r,samplePoints:2},{fn:y(n,e[0]),ind:"y",min:o,samplePoints:2}]}optimalBundle(t){const e=j(this.coefficients[0]),n=j(this.coefficients[1]),r=y(t.m,O(p(t.p1,e),p(t.p2,n)));return[p(e,r),p(n,r)]}lowestCostBundle(t,e){const n=this.coefficients[0],r=this.coefficients[1];return[y(t,n),y(t,r)]}}class ie extends et{value(t){const e=this.exponents;return`(${this.coefficients.length==1?this.coefficients[0]:1}*(${t[0]})^(${e[0]}))*((${t[1]})^(${e[1]}))`}levelSet(t){const e=this.exponents,n=this.coefficients.length==1?this.coefficients[0]:1,r=y(this.extractLevel(t),n),o=`(${r})^(1/(${e[0]} + ${e[1]}))`,s=`(${r})^(1/(${e[0]} + ${e[1]}))`;return this.fillBelowRect={x1:0,x2:o,y1:0,y2:s,show:t.show},[{fn:`((${r})/(y)^(${e[1]}))^(1/(${e[0]}))`,ind:"y",min:s,samplePoints:30},{fn:`((${r})/(x)^(${e[0]}))^(1/(${e[1]}))`,ind:"x",min:o,samplePoints:30}]}levelCurveSlope(t){const e=this.coefficients;return R(y(p(e[0],t[1]),p(e[1],t[0])))}optimalBundle(t){const e=this.alpha;return[p(e,t.xIntercept),p(x(1,e),t.yIntercept)]}lowestCostBundle(t,e){const n=this.exponents,r=p(y(e[0],e[1]),y(n[1],n[0])),o=O(n[0],n[1]),s=w(t,y(1,o));return[y(s,w(r,y(n[1],o))),p(s,w(r,y(n[0],o)))]}laborRequirement(t,e){const n=this.exponents;return`((${t})/(${e})^(${n[1]}))^(1/(${n[0]}))`}}class oe extends et{constructor(t){super(t);let e=this;e.interpolation="curveMonotoneX",t.hasOwnProperty("r")?(e.r=t.r,e.s=y(1,x(1,t.r))):t.hasOwnProperty("s")&&(e.s=t.s,e.r=x(1,y(1,t.s)))}value(t){const e=this.coefficients,n=this.r;return w(O(p(e[0],w(t[0],n)),p(e[1],w(t[1],n))),y(1,n))}levelSet(t){const e=this,n=ct(e.alpha),r=ct(e.r),o=x(1,e.alpha),s=this.extractLevel(t);return this.fillBelowRect={x1:0,x2:s,y1:0,y2:s,show:t.show},[{fn:`((${s}^${r} - ${n}*(x)^${r})/${o})^(1/${r})`,ind:"x",min:s},{fn:`((${s}^${r} - ${o}*(y)^${r})/${n})^(1/${r})`,ind:"y",min:s}]}optimalBundle(t){const e=this.s,n=x(1,e),r=this.alpha,o=x(1,r),s=y(t.m,O(p(w(r,e),w(t.p1,n)),p(w(o,e),w(t.p2,n)))),a=p(w(y(r,t.p1),e),s),l=p(w(y(o,t.p2),e),s);return[a,l]}denominator(t,e){const n=this.alpha,r=x(1,n),o=this.r,s=y(t,n),a=y(e,r),l=y(1,o),c=y(o,x(o,1));return w(O(p(n,w(s,c)),p(r,w(a,c))),l)}lowestCostBundle(t,e){const n=this.alpha,r=x(1,n),o=e[0],s=e[1],a=this.r,l=y(o,n),c=y(s,r),h=y(1,x(a,1)),m=this.denominator(o,s),g=w(l,h),v=w(c,h);return[y(p(t,g),m),y(p(t,v),m)]}}class se extends Ft{constructor(t,e){super(t,e),this.maskPath=t.maskPath}parseSelf(t){return t.markers.push(this.def),t}}class Dt extends se{constructor(t,e){t.name=L(10),super(t,e),this.color=t.color,this.arrowPath=t.arrowPath}}class Cn extends Dt{constructor(t,e){t.refX=2,t.maskPath="M10,1 L10,12 L0,7 L0,5 L10,1",t.arrowPath="M11,2 L11,11 L2,6 L11,2",super(t,e),this.markerType="StartArrow"}}class En extends Dt{constructor(t,e){t.refX=11,t.maskPath="M3,1 L3,12 L12,7 L12,5 L3,1",t.arrowPath="M2,2 L2,11 L10,6 L2,2",super(t,e),this.markerType="EndArrow"}}for(const i in Gt)Object.defineProperty(Q,i,{get:()=>Gt[i],enumerable:!0});class Fn extends I{constructor(t){u(t,{xScale2:t.xScale,yScale2:t.yScale,strokeWidth:2}),C(t,"constants",["xScale2","yScale2","startArrow","endArrow"]),C(t,"updatables",["x1","y1","x2","y2"]),super(t)}draw(t){let e=this;return e.rootElement=t.selectAll("g.rootElement-"+e.id).data([1]).join("g").attr("class","rootElement-"+e.id),e.dragLine=e.rootElement.selectAll("line.dragLine-"+e.id).data([1]).join("line").attr("class","dragLine-"+e.id).attr("stroke-width","20px").style("stroke","yellow").style("stroke-opacity",0),e.line=e.rootElement.selectAll("line.line-"+e.id).data([1]).join("line").attr("class","line-"+e.id),e.markedElement=e.line,e.addClipPathAndArrows().addInteraction()}redraw(){let t=this;const e=t.xScale.scale(t.x1),n=t.xScale.scale(t.x2),r=t.yScale2.scale(t.y1),o=t.yScale2.scale(t.y2);return t.dragLine.attr("x1",e).attr("y1",r).attr("x2",n).attr("y2",o),t.line.attr("x1",e).attr("y1",r).attr("x2",n).attr("y2",o),t.drawStroke(t.line),t}}class fn extends I{constructor(t){u(t,{opacity:.2,stroke:"none"}),C(t,"updatables",["x1","x2","y1","y2"]),super(t)}draw(t){let e=this;return e.inDef?e.rootElement=t:e.rootElement=t.selectAll("g.rootElement-"+e.id).data([1]).join("g").attr("class","rootElement-"+e.id),e.rootElement2=e.rootElement.selectAll("rect.rootElement2-"+e.id).data([1]).join("rect").attr("class","rootElement2-"+e.id),e.addClipPathAndArrows().addInteraction()}redraw(){let t=this;const e=t.xScale.scale(t.x1),n=t.yScale.scale(t.y1),r=t.xScale.scale(t.x2),o=t.yScale.scale(t.y2);return t.rootElement2.attr("x",Math.min(e,r)).attr("y",Math.min(n,o)).attr("width",Math.abs(r-e)).attr("height",Math.abs(o-n)).style("fill",t.fill).style("fill-opacity",t.opacity).style("stroke",t.stroke).style("stroke-width",`${t.strokeWidth}px`).style("stroke-opacity",t.strokeOpacity),t}}class An extends I{constructor(t){t.hasOwnProperty("label")&&!t.hasOwnProperty("srTitle")&&(t.srTitle=`Point ${t.label.text}`),u(t,{fill:"colors.blue",opacity:1,stroke:"white",strokeWidth:1,strokeOpacity:1,r:6}),C(t,"updatables",["x","y","r"]),super(t)}draw(t){let e=this;return e.rootElement=t.selectAll("g.rootElement-"+e.id).data([1]).join("g").attr("class","rootElement-"+e.id),e.dragCircle=e.rootElement.selectAll("circle.dragCircle-"+e.id).data([1]).join("circle").attr("class","dragCircle-"+e.id).style("fill","yellow").style("fill-opacity",0).attr("r",20),e.circle=e.rootElement.selectAll("circle.circle-"+e.id).data([1]).join("circle").attr("class","circle-"+e.id),e.addScreenReaderDescriptions(e.circle),e.addInteraction()}redraw(){let t=this;return t.updateScreenReaderDescriptions(),t.rootElement.attr("transform",`translate(${t.xScale.scale(t.x)} ${t.yScale.scale(t.y)})`),t.circle.attr("r",t.r),t.circle.style("fill",t.fill),t.circle.style("fill-opacity",t.opacity),t.circle.style("stroke",t.stroke),t.circle.style("stroke-width",`${t.strokeWidth}px`),t.circle.style("stroke-opacity",t.strokeOpacity),t}}class jn extends I{constructor(t){const e=t.xScale.rangeMin>t.xScale.rangeMax,n=t.yScale.rangeMin<t.yScale.rangeMax;let r=e?1:-1,o=n?12:-12;t.x=="AXIS"&&(t.x=t.yScale.intercept,t.align=e?"left":"right",t.xPixelOffset=r),t.x=="OPPAXIS"&&(t.x=t.xScale.domainMax,t.align=e?"right":"left",t.xPixelOffset=-r),t.y=="AXIS"&&(t.y=t.yScale.intercept,t.yPixelOffset=o),t.y=="OPPAXIS"&&(t.y=t.yScale.domainMax,t.yPixelOffset=-o),u(t,{xPixelOffset:0,yPixelOffset:0,fontSize:12,align:"center",valign:"middle",rotate:0,color:"black"}),C(t,"constants",["xPixelOffset","yPixelOffset","fontSize","plainText"]),C(t,"updatables",["x","y","text","align","valign","rotate","color","bgcolor"]),super(t),this.bgcolor=t.model.clearColor}draw(t){let e=this;const n=e.def.svgContainerDiv||f.select(t.node().parentNode.parentNode);return e.rootElement=n.selectAll("div.rootElement-"+e.id).data([1]).join("div").attr("class","rootElement-"+e.id+" draggable").style("position","absolute").style("font-size",e.fontSize+"pt").style("text-align","center").style("padding-left","3px").style("padding-right","3px"),e.addInteraction()}redraw(){let t=this;t.rootElement.style("color",t.color).style("background-color",t.bgcolor);const e=t.xScale.scale(t.x)+ +t.xPixelOffset,n=t.yScale.scale(t.y)-+t.yPixelOffset;let r=t.text;if(r!=null)if(typeof r=="string"&&(r=r.replace(/`\(([^)]+)\)`/g,(h,m)=>{const g=t.model.evaluate(m);return g!==void 0&&typeof g!="object"?String(g):h})),t.plainText)t.rootElement.text(r);else try{ye.render(r,t.rootElement.node())}catch{console.log("Error rendering KaTeX: ",r)}t.rootElement.style("left",e+"px"),t.rootElement.style("top",n+"px");const o=t.rootElement.node().clientWidth,s=t.rootElement.node().clientHeight;let a=o*.5;t.align=="left"?a=0:t.align=="right"&&(a=o),t.rootElement.style("left",e-a+"px");let l=s*.5;t.valign=="top"?l=0:t.valign=="bottom"&&(l=s),t.rootElement.style("top",n-l+"px");const c=`rotate(-${t.rotate}deg)`;return t.rootElement.style("-webkit-transform",c).style("transform",c),t}}class Ln extends I{constructor(t){u(t,{color:"#999999",lineThickness:1,lineStyle:0}),C(t,"constants",["command","color","lineThickness","lineStyle"]),super(t)}establishGGB(t){function e(s){const a=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(s);return a?{r:parseInt(a[1],16),g:parseInt(a[2],16),b:parseInt(a[3],16)}:null}const n=this,r=n.name+" = "+n.command;t.evalCommand(r),n.hasOwnProperty("opacity")&&t.setFilling(n.opacity);const o=e(n.color);t.setColor(n.name,o.r,o.g,o.b),t.evalCommand("SetLineThickness["+n.name+", "+n.lineThickness+"]"),t.setLineStyle(n.name,n.lineStyle)}}class It extends ht{constructor(t){u(t,{samplePoints:50}),C(t,"constants",["samplePoints"]),C(t,"updatables",["min","max"]),super(t)}updateFunctionString(t,e){function n(s,a){a=a.replace(/\[(\w+)\]/g,".$1"),a=a.replace(/^\./,"");let l=a.split(".");for(let c=0,h=l.length;c<h;++c){let m=l[c];if(m in s)s=s[m];else return}return s}if(t=t.toString(),t.indexOf("null")>-1||t.indexOf("Infinity")>-1)return null;const r=/((calcs|params).[.\w]*)+/g,o=t.match(r);return o&&o.forEach(function(s){t=it(t,s,n(e,s))}),t}}class $n extends It{constructor(t){u(t,{min:0,max:10}),super(t),this.xFunctionStringDef=t.xFunction,this.yFunctionStringDef=t.yFunction}evaluate(t){let e=this;return e.scope=e.scope||{params:e.model.currentParamValues},e.scope.t=t,{x:e.xCompiledFunction.evaluate(e.scope),y:e.yCompiledFunction.evaluate(e.scope)}}generateData(t,e){let n=this,r=[];n.min!=null&&(t=n.min),n.max!=null&&(e=n.max);for(let o=0;o<n.samplePoints+1;o++){let s=o/n.samplePoints,a=s*t+(1-s)*e,l=n.evaluate(a);!isNaN(l.x)&&l.x!=1/0&&l.x!=-1/0&&!isNaN(l.y)&&l.y!=1/0&&l.y!=-1/0&&r.push(l)}return this.data=r,r}update(t){let e=super.update(t);return e.scope={params:e.model.currentParamValues,calcs:e.model.currentCalcValues,colors:e.model.currentColors},e.xFunctionString!=e.updateFunctionString(e.xFunctionStringDef,e.scope)&&(e.hasChanged=!0,e.xFunctionString=e.updateFunctionString(e.xFunctionStringDef,e.scope),e.xCompiledFunction=V.compile(e.xFunctionString)),e.yFunctionString!=e.updateFunctionString(e.yFunctionStringDef,e.scope)&&(e.hasChanged=!0,e.yFunctionString=e.updateFunctionString(e.yFunctionStringDef,e.scope),e.yCompiledFunction=V.compile(e.yFunctionString)),e}}class Ct extends It{constructor(t){u(t,{ind:"x"}),C(t,"constants",["fn","yFn"]),C(t,"updatables",["ind","min","max"]),super(t),this.fnStringDef=t.fn,this.fnZStringDef=t.fnZ,this.yFnStringDef=t.yFn,this.yFnZStringDef=t.yFnZ}evaluate(t,e){let n=this;if(e){if(n.hasOwnProperty("yzCompiledFunction")&&n.ind=="y")return n.yzCompiledFunction.evaluate({y:t});if(n.hasOwnProperty("zCompiledFunction")&&n.ind=="y")return n.zCompiledFunction.evaluate({y:t});if(n.hasOwnProperty("zCompiledFunction"))return n.zCompiledFunction.evaluate({x:t})}else{if(n.hasOwnProperty("yCompiledFunction")&&n.ind=="y")return n.yCompiledFunction.evaluate({y:t});if(n.hasOwnProperty("compiledFunction")&&n.ind=="y")return n.compiledFunction.evaluate({y:t});if(n.hasOwnProperty("compiledFunction"))return n.compiledFunction.evaluate({x:t})}}generateData(t,e){let n=this,r=[];n.min!=null&&(t=n.min),n.max!=null&&(e=n.max);for(let o=0;o<n.samplePoints+1;o++){let s=o/n.samplePoints,a=s*t+(1-s)*e,l=n.evaluate(a);!isNaN(l)&&l!=1/0&&l!=-1/0&&r.push(n.ind=="x"?{x:a,y:l}:{x:l,y:a})}return this.data=r,r}update(t){let e=super.update(t);return e.scope={params:e.model.currentParamValues,calcs:e.model.currentCalcValues,colors:e.model.currentColors},e.fnString!=e.updateFunctionString(e.fnStringDef,e.scope)&&(e.hasChanged=!0,e.fnString=e.updateFunctionString(e.fnStringDef,e.scope),e.compiledFunction=V.compile(e.fnString)),e.def.hasOwnProperty("yFn")&&e.yFnString!=e.updateFunctionString(e.yFnStringDef,e.scope)&&(e.hasChanged=!0,e.yFnString=e.updateFunctionString(e.yFnStringDef,e.scope),e.yCompiledFunction=V.compile(e.yFnString)),e.def.hasOwnProperty("fnZ")&&e.fnZString!=e.updateFunctionString(e.fnZStringDef,e.scope)&&(e.hasChanged=!0,e.fnZString=e.updateFunctionString(e.fnZStringDef,e.scope),e.zCompiledFunction=V.compile(e.fnZString)),e.def.hasOwnProperty("yFnZ")&&e.yFnZString!=e.updateFunctionString(e.yFnZStringDef,e.scope)&&(e.hasChanged=!0,e.yFnZString=e.updateFunctionString(e.yFnZStringDef,e.scope),e.yzCompiledFunction=V.compile(e.yFnZString)),e}}class kn extends I{constructor(t){let e,n;u(t,{interpolation:"curveBasis",strokeWidth:2}),C(t,"constants",["interpolation"]),t.hasOwnProperty("univariateFunction")?(t.univariateFunction.model=t.model,e=new Ct(t.univariateFunction),C(t,"updatables",[])):t.hasOwnProperty("parametricFunction")&&(t.parametricFunction.model=t.model,n=new $n(t.parametricFunction),C(t,"updatables",[])),super(t);let r=this;t.hasOwnProperty("univariateFunction")?r.univariateFunction=e:t.hasOwnProperty("parametricFunction")&&(t.parametricFunction.model=t.model,r.parametricFunction=n)}draw(t){let e=this;return e.dataLine=f.line().curve(f[e.interpolation]).x(function(n){return e.xScale.scale(n.x)}).y(function(n){return e.yScale.scale(n.y)}),e.rootElement=t.selectAll("g.rootElement-"+e.id).data([1]).join("g").attr("class","rootElement-"+e.id),e.dragPath=e.rootElement.selectAll("path.dragPath-"+e.id).data([1]).join("path").attr("class","dragPath-"+e.id).attr("stroke-width","20px").style("stroke","yellow").style("stroke-opacity",0).style("fill","none"),e.path=e.rootElement.selectAll("path.path-"+e.id).data([1]).join("path").attr("class","path-"+e.id).style("fill","none"),e.addScreenReaderDescriptions(e.path),e.path.on("focus",function(){e.dragPath.style("fill","yellow")}),e.path.on("blur",function(){e.dragPath.style("fill","none")}),e.addClipPathAndArrows().addInteraction()}redraw(){let t=this;if(t.hasOwnProperty("univariateFunction")){const e=t.univariateFunction,n=e.ind=="y"?t.yScale:t.xScale;e.generateData(n.domainMin,n.domainMax),t.dragPath.data([e.data]).attr("d",t.dataLine),t.path.data([e.data]).attr("d",t.dataLine)}if(t.hasOwnProperty("parametricFunction")){const e=t.parametricFunction;e.generateData(),t.dragPath.data([e.data]).attr("d",t.dataLine),t.path.data([e.data]).attr("d",t.dataLine)}return t.drawStroke(t.path),t}update(t){let e=super.update(t);return e.hasChanged||(e.hasOwnProperty("univariateFunction")&&e.univariateFunction.hasChanged&&e.redraw(),e.hasOwnProperty("parametricFunction")&&e.parametricFunction.hasChanged&&e.redraw()),e}}class _t extends It{constructor(t){t.samplePoints=100,C(t,"constants",["fn"]),super(t),this.fnStringDef=t.fn,this.domainConditionStringDef=t.domainCondition}inDomain(t,e,n){let r=this;return r.hasOwnProperty("compiledDomainCondition")?r.compiledDomainCondition.evaluate({x:t,y:e,z:n}):!0}evaluate(t,e){let n=this;if(n.hasOwnProperty("compiledFunction")){const r=n.compiledFunction.evaluate({x:t,y:e});if(n.inDomain(t,e,r))return r}}contour(t,e,n,r){const o=this;r=u(r||{},{xMin:e.domainMin,xMax:e.domainMax,yMin:n.domainMin,yMax:n.domainMax});let s=100,a=100,l=new Array(s*a);for(let g=.5,v=0;g<a;++g)for(let P=.5;P<s;++P,++v){let $=r.xMin+P*(r.xMax-r.xMin)/s,b=r.yMin+g*(r.yMax-r.yMin)/a;l[v]=o.evaluate($,b)}let c=({type:g,value:v,coordinates:P})=>({type:g,value:v,coordinates:P.map($=>$.map(b=>b.map(([T,X])=>[e.scale(r.xMin+T*(r.xMax-r.xMin)/100),n.scale(r.yMin+X*(r.yMax-r.yMin)/100)])))});const h=f.geoPath(),m=f.contours().size([s,a]).contour(l,t);return h(c(m))}update(t){let e=super.update(t);e.scope={params:e.model.currentParamValues,calcs:e.model.currentCalcValues,colors:e.model.currentColors};const n=e.fnString,r=e.domainConditionString;return n!=e.updateFunctionString(e.fnStringDef,e.scope)&&(e.hasChanged=!0,e.fnString=e.updateFunctionString(e.fnStringDef,e.scope),e.compiledFunction=V.compile(e.fnString)),e.domainConditionStringDef!=null&&r!=e.updateFunctionString(e.domainConditionStringDef,e.scope)&&(e.hasChanged=!0,e.domainConditionString=e.updateFunctionString(e.domainConditionStringDef,e.scope),e.compiledDomainCondition=V.compile(e.domainConditionString)),e}}class Mn extends I{constructor(t){u(t,{opacity:.2,stroke:"grey",fillAbove:"none",fillBelow:"none",strokeOpacity:1}),C(t,"colorAttributes",["fillAbove","fillBelow"]),C(t,"updatables",["level","fillBelow","fillAbove","xMin","xMax","yMin","yMax"]),super(t),this.fn=new _t({fn:t.fn,model:t.model}).update(!0),this.negativeFn=new _t({fn:`-1*(${t.fn})`,model:t.model}).update(!0)}draw(t){let e=this;return e.inDef?(e.rootElement=t.selectAll("path.rootElement-"+e.id).data([1]).join("path").attr("class","rootElement-"+e.id),e.path=e.rootElement):(e.rootElement=t.selectAll("g.rootElement-"+e.id).data([1]).join("g").attr("class","rootElement-"+e.id),e.negativePath=e.rootElement.selectAll("path.negativePath-"+e.id).data([1]).join("path").attr("class","negativePath-"+e.id),e.path=e.rootElement.selectAll("path.path-"+e.id).data([1]).join("path").attr("class","path-"+e.id)),e.addClipPathAndArrows()}redraw(){let t=this;return t.fn!=null&&(["xMin","xMax","yMin","yMax"].forEach(function(e){t.hasOwnProperty(e)&&t[e]!=null&&t[e]}),t.path.attr("d",t.fn.contour(t.level,t.xScale,t.yScale,{xMin:t.xMin,xMax:t.xMax,yMin:t.yMin,yMax:t.yMax})),t.inDef||(t.path.style("fill",t.fillAbove),t.path.style("fill-opacity",t.opacity),t.path.style("stroke",t.stroke),t.path.style("stroke-width",t.strokeWidth),t.path.style("stroke-opacity",t.strokeOpacity),t.negativePath.attr("d",t.negativeFn.contour(-1*t.level,t.xScale,t.yScale)),t.negativePath.style("fill",t.fillBelow),t.negativePath.style("fill-opacity",t.opacity))),t}update(t){let e=super.update(t);return e.hasChanged||e.fn.hasChanged&&e.redraw(),e}}class Dn extends I{constructor(t){super(t)}}class ae extends I{constructor(t){u(t,{fill:"colors.blue",opacity:1,stroke:"colors.blue",strokeWidth:1,strokeOpacity:1,rx:1,ry:1,checkOnGraph:!1}),C(t,"updatables",["x","y","rx","ry"]),super(t)}draw(t){let e=this;return e.rootElement=t.selectAll("ellipse.rootElement-"+e.id).data([1]).join("ellipse").attr("class","rootElement-"+e.id),e.addClipPathAndArrows().addInteraction()}redraw(){let t=this;return t.rootElement.attr("cx",t.xScale.scale(t.x)),t.rootElement.attr("cy",t.yScale.scale(t.y)),t.rootElement.attr("rx",Math.abs(t.xScale.scale(t.rx)-t.xScale.scale(0))),t.rootElement.attr("ry",Math.abs(t.yScale.scale(t.ry)-t.yScale.scale(0))),t.drawFill(t.rootElement),t.drawStroke(t.rootElement),t}}class In extends ae{constructor(t){super(t)}}class Gn extends I{constructor(t){u(t,{ticks:5,intercept:0}),C(t,"constants",["orient"]),C(t,"updatables",["ticks","intercept","label","min","max","otherMin","otherMax","tickPrepend","tickPrecision","tickValues"]),super(t)}draw(t){let e=this;return e.rootElement=t.selectAll("g.rootElement-"+e.id).data([1]).join("g").attr("class","rootElement-"+e.id).attr("class","axis"),e}redraw(){let t=this;function e(n){return t.tickPrecision&&(n=n.toFixed(t.tickPrecision)),t.tickPrepend?`${t.tickPrepend}${n}`:n}switch(t.orient){case"bottom":return t.rootElement.attr("transform",`translate(0, ${t.yScale.scale(t.intercept)})`),t.tickValues?t.rootElement.call(f.axisBottom(t.xScale.scale).tickValues(t.tickValues).tickFormat(e)):t.rootElement.call(f.axisBottom(t.xScale.scale).ticks(t.ticks).tickFormat(e)),t;case"left":return t.rootElement.attr("transform",`translate(${t.xScale.scale(t.intercept)},0)`),t.tickValues?t.rootElement.call(f.axisLeft(t.yScale.scale).tickValues(t.tickValues).tickFormat(e)):t.rootElement.call(f.axisLeft(t.yScale.scale).ticks(t.ticks).tickFormat(e)),t;case"top":return t.rootElement.attr("transform",`translate(0, ${t.yScale.scale(t.intercept)})`),t.tickValues?t.rootElement.call(f.axisTop(t.xScale.scale).tickValues(t.tickValues).tickFormat(e)):t.rootElement.call(f.axisTop(t.xScale.scale).ticks(t.ticks).tickFormat(e)),t;case"right":return t.rootElement.attr("transform",`translate(${t.xScale.scale(t.intercept)},0)`),t.tickValues?t.rootElement.call(f.axisRight(t.yScale.scale).tickValues(t.tickValues).tickFormat(e)):t.rootElement.call(f.axisRight(t.yScale.scale).ticks(t.ticks).tickFormat(e)),t}return t}}class Rn extends I{constructor(t){const e=t.univariateFunction1.ind=="x"?t.yScale.domainMin:t.xScale.domainMin,n=t.univariateFunction1.ind=="x"?t.yScale.domainMax:t.xScale.domainMax;u(t,{interpolation:"curveBasis",ind:"x",fill:"lightsteelblue",opacity:.2,univariateFunction2:{fn:t.above&&!t.useTopScale||!t.above&&t.useTopScale?n:e,ind:t.univariateFunction1.ind,min:t.univariateFunction1.min,max:t.univariateFunction1.max,samplePoints:t.univariateFunction1.samplePoints}}),C(t,"constants",["interpolation"]),t.univariateFunction1.model=t.model,t.univariateFunction2.model=t.model;const r=new Ct(t.univariateFunction1),o=new Ct(t.univariateFunction2);super(t),this.univariateFunction1=r,this.univariateFunction2=o}draw(t){let e=this;return e.rootElement=t.selectAll("path.rootElement-"+e.id).data([1]).join("path").attr("class","rootElement-"+e.id),e.areaShape=f.area().x0(function(n){return e.xScale.scale(n[0].x)}).y0(function(n){return e.yScale.scale(n[0].y)}).x1(function(n){return e.xScale.scale(n[1].x)}).y1(function(n){return e.yScale.scale(n[1].y)}),e.areaPath=e.rootElement,e.addClipPathAndArrows()}redraw(){const t=this;if(t.univariateFunction1!=null&&t.univariateFunction2!=null){const e=t.univariateFunction1,n=t.univariateFunction2,r=e.ind=="y"?t.yScale:t.xScale;e.generateData(r.domainMin,r.domainMax),n.generateData(r.domainMin,r.domainMax),t.areaPath.data([f.zip(e.data,n.data)]).attr("d",t.areaShape),t.drawFill(t.areaPath)}return t}update(t){let e=super.update(t);return e.hasChanged||(e.univariateFunction1.hasChanged||e.univariateFunction2.hasChanged)&&e.redraw(),e}}const yt=me;class Bn{constructor(t,e,n){this.viewOptions=n||{},this.render(e,t)}parse(t,e){if(t.hasOwnProperty("templateDefaults")){const s=t.templateDefaults;let a=JSON.stringify(t);for(const l in s){let c=new RegExp("template.\\b"+l+"\\b","g"),h=s[l];a=a.replace(c,h)}t=JSON.parse(a)}t.schema=t.schema||"Schema";const n=!!this.viewOptions.legacyUrlOverrides;let r=null;if(n)try{r=new URLSearchParams(window.location.search)}catch{}t.params=(t.params||[]).map(function(s){if(n&&(e&&e.hasAttribute&&e.hasAttribute(s.name)&&(s.value=e.getAttribute(s.name)),r)){const a=r.get(s.name);a&&(s.value=a)}return s.value=="true"&&(s.value=1),s.value=="false"&&(s.value=0),s.value=isNaN(+s.value)?s.value:+s.value,s}),n&&e&&e.hasAttribute&&e.hasAttribute("clearColor")&&(t.clearColor=e.getAttribute("clearColor"));let o={templateDefaults:t.templateDefaults||{},aspectRatio:t.aspectRatio||1,clearColor:t.clearColor||"#FFFFFF",params:t.params||[],calcs:t.calcs||{},colors:t.colors||{},custom:t.custom||"",idioms:{},restrictions:t.restrictions,clipPaths:t.clipPaths||[],markers:t.markers||[],scales:t.scales||[{name:"x",axis:"x",rangeMin:0,rangeMax:1,domainMin:0,domainMax:1},{name:"y",axis:"y",rangeMin:0,rangeMax:1,domainMin:0,domainMax:1}],layers:t.layers||[[],[],[],[]],divs:t.divs||[]};if(t.objects=t.objects||[],t.hasOwnProperty("layout"))if(t.layout.hasOwnProperty("type"))t.objects.push(t.layout);else{const s=Object.keys(t.layout)[0],a=t.layout[s];t.objects.push({type:s,def:a})}return t.hasOwnProperty("explanation")&&t.objects.push({type:"Explanation",def:t.explanation}),t.hasOwnProperty("schema")&&(n&&r&&r.get("custom")&&(o.custom=r.get("custom")),t.objects.push({type:t.schema,def:{custom:o.custom}})),Se(t.objects,o)}render(t,e){let n=this;const r=n.parse(t,e);e.innerHTML="",n.aspectRatio=t.aspectRatio||r.aspectRatio||1,n.model=new be(r),n.scales=r.scales.map(function(o){return o.model=n.model,new we(o)}),n.div=f.select(e).style("position","relative"),n.svgContainerDiv=n.div.append("div").style("position","absolute").style("left","0px").style("top","0px"),r.nosvg||(n.svg=n.svgContainerDiv.append("svg").style("overflow","visible").style("pointer-events","none")),n.addViewObjects(r),n.parsedData=r}addViewToDef(t,e){const n=this;function r(o){let s=null;return n.scales.forEach(function(a){a.name==o&&(s=a)}),s}return t.model=n.model,t.layer=e,t.svgContainerDiv=n.svgContainerDiv,t.xScale=r(t.xScaleName),t.yScale=r(t.yScaleName),t.hasOwnProperty("xScale2Name")&&(t.xScale2=r(t.xScale2Name),t.yScale2=r(t.yScale2Name)),t}addViewObjects(t){const e=this;let n={};if(e.svg){const r=e.svg.append("defs");t.clipPaths.length>0&&t.clipPaths.forEach(function(o){const s=L(10),a=r.append("clipPath").attr("id",s);o.paths.forEach(function(l){l.def.inDef=!0,new yt[l.type](e.addViewToDef(l.def,a))}),n[o.name]=s}),t.markers.length>0&&t.markers.forEach(function(o){const s=L(10);o.url=s,n[o.name]=s;const a=r.append("marker").attr("id",s).attr("refX",o.refX).attr("refY",6).attr("markerWidth",13).attr("markerHeight",13).attr("orient","auto").attr("markerUnits","userSpaceOnUse");e.addViewToDef(o,a),new Tt(o)}),t.layers.forEach(function(o){if(o.length>0){const s=e.svg.append("g");o.forEach(function(a){let l=a.def;l.hasOwnProperty("clipPathName")&&(l.clipPath=n[l.clipPathName]),l.hasOwnProperty("clipPathName2")&&(l.clipPath2=n[l.clipPathName2]),l.hasOwnProperty("startArrowName")&&(l.startArrow=n[l.startArrowName]),l.hasOwnProperty("endArrowName")&&(l.endArrow=n[l.endArrowName]),l=e.addViewToDef(l,s),new yt[a.type](l)})}})}if(t.divs&&t.divs.length>0){const r=e.svgContainerDiv;t.divs.forEach(function(o){let s=o.def;s=e.addViewToDef(s,r),new yt[o.type](s)})}e.updateDimensions()}updateDimensions(t){let e=this;t=!!t;let n=0,r=0,o=0;if(t)n=600,r=n/e.aspectRatio,o=r+20;else{n=e.div.node().clientWidth,r=n/e.aspectRatio;let a=0,l=0;if(e.sidebar)if(n>e.sidebar.triggerWidth){r=r*77/126;let c;e.explanation?c=r+e.explanation.rootElement.node().clientHeight+10:c=r,e.sidebar.positionRight(n,c),n=n*77/126}else e.sidebar.positionBelow(n,r),a=e.sidebar.rootElement.node().clientHeight+30;e.explanation&&(e.explanation.position(n,r+a+10),l=e.explanation.rootElement.node().clientHeight+20),o=r+a+l+10}e.div.style("height",o+"px"),e.svgContainerDiv.style("width",n),e.svgContainerDiv.style("height",r),e.svg&&(e.svg.style("width",n),e.svg.style("height",r),e.svg.attr("width",n),e.svg.attr("height",r)),e.scales.forEach(function(s){s.updateDimensions(n,r)}),e.model.update(!0)}}const _n={PARAM_CHANGED:"kg:param_changed",CURVE_DRAGGED:"kg:curve_dragged",NODE_HOVER:"kg:node_hover"};function Nn(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var le={exports:{}};(function(i){var t=Object.prototype.hasOwnProperty,e="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(e=!1));function r(l,c,h){this.fn=l,this.context=c,this.once=h||!1}function o(l,c,h,m,g){if(typeof h!="function")throw new TypeError("The listener must be a function");var v=new r(h,m||l,g),P=e?e+c:c;return l._events[P]?l._events[P].fn?l._events[P]=[l._events[P],v]:l._events[P].push(v):(l._events[P]=v,l._eventsCount++),l}function s(l,c){--l._eventsCount===0?l._events=new n:delete l._events[c]}function a(){this._events=new n,this._eventsCount=0}a.prototype.eventNames=function(){var c=[],h,m;if(this._eventsCount===0)return c;for(m in h=this._events)t.call(h,m)&&c.push(e?m.slice(1):m);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(h)):c},a.prototype.listeners=function(c){var h=e?e+c:c,m=this._events[h];if(!m)return[];if(m.fn)return[m.fn];for(var g=0,v=m.length,P=new Array(v);g<v;g++)P[g]=m[g].fn;return P},a.prototype.listenerCount=function(c){var h=e?e+c:c,m=this._events[h];return m?m.fn?1:m.length:0},a.prototype.emit=function(c,h,m,g,v,P){var $=e?e+c:c;if(!this._events[$])return!1;var b=this._events[$],T=arguments.length,X,F;if(b.fn){switch(b.once&&this.removeListener(c,b.fn,void 0,!0),T){case 1:return b.fn.call(b.context),!0;case 2:return b.fn.call(b.context,h),!0;case 3:return b.fn.call(b.context,h,m),!0;case 4:return b.fn.call(b.context,h,m,g),!0;case 5:return b.fn.call(b.context,h,m,g,v),!0;case 6:return b.fn.call(b.context,h,m,g,v,P),!0}for(F=1,X=new Array(T-1);F<T;F++)X[F-1]=arguments[F];b.fn.apply(b.context,X)}else{var ce=b.length,lt;for(F=0;F<ce;F++)switch(b[F].once&&this.removeListener(c,b[F].fn,void 0,!0),T){case 1:b[F].fn.call(b[F].context);break;case 2:b[F].fn.call(b[F].context,h);break;case 3:b[F].fn.call(b[F].context,h,m);break;case 4:b[F].fn.call(b[F].context,h,m,g);break;default:if(!X)for(lt=1,X=new Array(T-1);lt<T;lt++)X[lt-1]=arguments[lt];b[F].fn.apply(b[F].context,X)}}return!0},a.prototype.on=function(c,h,m){return o(this,c,h,m,!1)},a.prototype.once=function(c,h,m){return o(this,c,h,m,!0)},a.prototype.removeListener=function(c,h,m,g){var v=e?e+c:c;if(!this._events[v])return this;if(!h)return s(this,v),this;var P=this._events[v];if(P.fn)P.fn===h&&(!g||P.once)&&(!m||P.context===m)&&s(this,v);else{for(var $=0,b=[],T=P.length;$<T;$++)(P[$].fn!==h||g&&!P[$].once||m&&P[$].context!==m)&&b.push(P[$]);b.length?this._events[v]=b.length===1?b[0]:b:s(this,v)}return this},a.prototype.removeAllListeners=function(c){var h;return c?(h=e?e+c:c,this._events[h]&&s(this,h)):(this._events=new n,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=e,a.EventEmitter=a,i.exports=a})(le);var Tn=le.exports;const Vn=Nn(Tn);class zn extends Vn{constructor(t,e){super(),this.container=null,this.view=null,this.resizeObserver=null,this.config=t,this.options=e||{}}mount(t){this.container=t,this.container.classList.add("kg-container");try{const e=JSON.parse(JSON.stringify(this.config));this.view=new Bn(this.container,e,{legacyUrlOverrides:!!this.options.legacyUrlOverrides}),this.view.emitter=this,this.resizeObserver=new ResizeObserver(()=>{this.view&&this.view.updateDimensions()}),this.resizeObserver.observe(t)}catch(e){this.emit("error",e)}}update(t){this.config={...this.config,...t},this.view&&(t.params?t.params.forEach(e=>{this.view.model.updateParam(e.name,e.value)}):this.view.model.update(!0))}destroy(){this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null),this.container&&(this.container.classList.remove("kg-container"),this.container.innerHTML=""),this.view=null,this.container=null,this.removeAllListeners()}}exports.KG_EVENTS=_n;exports.KineticGraph=zn;
